!function(e,t){var n=function(){return t(e)};"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):breeze=n()}(this,function(e){"use strict";function t(e,t){for(var n in e)et(e,n)&&t(n,e[n])}function n(e,t){for(var n in e)if(et(e,n)){var r=e[n];if(t(n,r))return{key:n,value:r}}return null}function r(e,t){var n=[];for(var r in e)if(et(e,r)){var a=t?t(r,e[r]):e[r];void 0!==a&&n.push(a)}return n}function a(e,t){var n=i(e,t);return null==n?!0:!(!n.writable&&!n.set)}function i(e,t){if(!nt)return null;if(e.hasOwnProperty(t))return Object.getOwnPropertyDescriptor(e,t);var n=Object.getPrototypeOf(e);return null==n?null:i(n,t)}function o(e,t){return function(n){return n[e]===t}}function s(e){return function(t){return t[e]}}function u(e){var t=[];for(var n in e)et(e,n)&&t.push(e[n]);return t}function p(e,t,n){if(!t)return e;if(n)n.forEach(function(n){e[n]=t[n]});else for(var r in t)et(t,r)&&(e[r]=t[r]);return e}function c(e,t){for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e}function l(e,t){return t.defaultInstance=c(new t(e),t.defaultInstance),e}function y(e,t){var n={};for(var r in t)if(r in e){var a=e[r],i=t[r];a!=i&&(Array.isArray(a)&&0===a.length||("function"==typeof i?a=i(a):"object"==typeof a&&a&&a.parentEnum&&(a=a.name),void 0!==a&&(n[r]=a)))}return n}function f(e,t){if(e!==Object(e))return e;if(e._$visited)return void 0;if(e.toJSON){var n=e.toJSON();if(n!==Object(n))return n;if(n!==e)return f(n);e=n}e._$visited=!0;var r;if(e instanceof Array)r=e.map(function(e){return f(e,t)});else if("function"==typeof e)r=void 0;else{r={};for(var a in e)if("_$visited"!==a){var i=e[a];t&&(i=t(a,i),void 0===i)||(i=f(i),void 0!==i&&(r[a]=i))}}return delete e._$visited,r}function h(e,t){var n={},r=e.length;return t.forEach(function(t){for(var a=0;r>a;a++){var i=e[a];if(i){var o=i[t];if(void 0!==o){n[t]=o;break}}}}),n}function d(e){return null==e?[]:Array.isArray(e)?e:[e]}function m(e,t){if(null==e)return e;var n;return Array.isArray(e)?(n=[],e.map(function(e,r){n[r]=t(e,r)})):n=t(e),n}function v(e,t){for(var n=0,r=e.length;r>n;n++)if(t(e[n]))return e[n];return null}function g(e,t){for(var n=0,r=e.length;r>n;n++)if(t(e[n]))return n;return-1}function E(e,t){var n=e.indexOf(t);-1===n&&e.push(t)}function S(e,t,n){for(var r=M(t)?t:void 0,a=e.length-1,i=!1,o=a;o>=0;o--)if((r?r(e[o]):e[o]===t)&&(e.splice(o,1),i=!0,!n))return!0;return i}function w(e,t,n){for(var r=[],a=Math.min(e.length,t.length),i=0;a>i;++i)r.push(n(e[i],t[i]));return r}function T(e,t,n){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){if(!T(e[r],t[r]))return!1}else if(n){if(!n(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}function _(e,t){var n=e[t];return n||(n=[],e[t]=n),n}function P(e,t){for(var n=e.split(";"),r=0,a=n.length;a>r;r++){var i=b(n[r]);if(i)return i}if(t)throw new Error("Unable to initialize "+e+".  "+t)}function b(t){var n=e.window;if(n){var r=n[t];if(r)return r;var a=n.require;if(a){if(a.defined)return a.defined(t)?a(t):void 0;try{return a(t)}catch(i){return}}}}function N(e,t,n,r){var a=e[t];if(n===a)return r();e[t]=n;try{return r()}finally{void 0===a?delete e[t]:e[t]=a}}function O(e,t,n){var r;try{return r=e(),n()}catch(a){throw"object"==typeof r&&(r.error=a),a}finally{t(r)}}function A(e){return function(){for(var t=tt(arguments),n="",r=t.length,a=null;r--;)a=t[r],n+=a===Object(a)?JSON.stringify(a):a,e.memoize||(e.memoize={});return n in e.memoize?e.memoize[n]:e.memoize[n]=e.apply(this,t)}}function C(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function F(e){if("string"!=typeof e)throw new Error("Invalid ISO8601 duration '"+e+"'");var t=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e);if(!t)throw new Error("Invalid ISO8601 duration '"+e+"'");for(var n=[2,3,4,6,7,8],r=[31104e3,2592e3,86400,3600,60,1],a=0,i=0;6>i;i++){var o=t[n[i]];o=o?+o.replace(/[A-Za-z]+/g,""):0,a+=o*r[i]}return a}function x(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function D(e){return"date"===x(e)&&!isNaN(e.getTime())}function M(e){return"function"===x(e)}function k(e){return"string"==typeof e&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(e)}function I(e){return"string"==typeof e&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(e)}function V(e){if(null===e||void 0===e)return!0;for(var t in e)if(et(e,t))return!1;return!0}function R(e){return!isNaN(parseFloat(e))&&isFinite(e)}function j(e,t){return e?""==t||null==t?!0:0===e.indexOf(t,0):!1}function K(e,t){return e?""==t||null==t?!0:-1!==e.indexOf(t,e.length-t.length):!1}function q(e){var t=arguments,n=RegExp("%([1-"+(arguments.length-1)+"])","g");return e.replace(n,function(e,n){return t[n]})}function L(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function z(e,t,n){void 0===t&&(t=null);var r=n(),a=e.dataType;if(a&&a.parse&&(t=Array.isArray(t)&&!e.isScalar?t.map(function(e){return a.parse(e,typeof e)}):a.parse(t,typeof t)),!(t===r||a&&a.isDate&&t&&r&&t.valueOf()===r.valueOf())){var i,o=this.entityAspect;if(o)i=e.name;else{var s=this.complexAspect;if(!s)return void n(t);o=s.getEntityAspect(),i=s.getPropertyPath(e.name)}var u=o._inProcess=o._inProcess||[];if(!(u.indexOf(e)>=0)){u.push(e);try{var p={parent:this,property:e,newValue:t,oldValue:r,propertyName:i,entityAspect:o};e.isComplexProperty?U(p,n):e.isDataProperty?B(p,n):$(p,n),G(p)}finally{u.pop()}}}}function B(e,t){var n=e.parent,r=e.property,a=e.entityAspect,i=e.oldValue,o=e.newValue,s=a.entityManager,u=n.entityType;if(!r.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(a.entityState.isUnchangedOrModified()){var p=r.name,c=n.entityAspect||n.complexAspect;void 0===c.originalValues[p]&&(c.originalValues[p]=void 0!==i?i:r.defaultValue)}if(r.isPartOfKey&&s&&!s.isLoading){var l=u.keyProperties,y=l.map(function(e){return e===r?o:n.getProperty(e.name)}),f=new Et(u,y);if(s.findEntityByKey(f))throw new Error("An entity with this key is already in the cache: "+f.toString());var h=n.entityAspect.getKey(),d=s._findEntityGroup(u);d._replaceKey(h,f)}var m=r.relatedNavigationProperty;if(m&&s)if(null!=o){var v=new Et(m.entityType,[o]),g=s.findEntityByKey(v);g?n.setProperty(m.name,g):s._unattachedChildrenMap.addChild(v,m,n)}else n.setProperty(m.name,null);else if(r.inverseNavigationProperty&&s&&!s._inKeyFixup){var E=r.inverseNavigationProperty;if(null!=i&&(v=new Et(E.parentType,[i]),g=s.findEntityByKey(v)))if(E.isScalar)g.setProperty(E.name,null);else{var S=g.getProperty(E.name);S.splice(S.indexOf(n),1)}null!=o&&(v=new Et(E.parentType,[o]),g=s.findEntityByKey(v),g?E.isScalar?g.setProperty(E.name,n):g.getProperty(E.name).push(n):s._unattachedChildrenMap.addChild(v,E,n))}if(t(o),Q(e),r.isPartOfKey){var w=u.keyProperties.indexOf(r);u.navigationProperties.forEach(function(e){var t=e.inverse,r=t?t.foreignKeyNames:e.invForeignKeyNames;if(0!==r.length){var a=n.getProperty(e.name),i=r[w];if(e.isScalar){if(!a)return;a.setProperty(i,o)}else a.forEach(function(e){e.setProperty(i,o)})}}),s&&u.inverseForeignKeyProperties.forEach(function(e){null==e.relatedNavigationProperty.inverse&&s._updateFkVal(e,i,o)}),a.getKey(!0)}}function U(e,t){var n=e.property,r=e.oldValue,a=e.newValue,i=n.dataType;if(!n.isScalar)throw new Error(q("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",n.name,n.parentType.name));if(!a)throw new Error(q("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",n.name,n.dataType.name));if(!r){var o=i.getCtor();r=new o,t(r)}i.dataProperties.forEach(function(e){var t=e.name,n=a.getProperty(t);r.setProperty(t,n)})}function $(e,t){var n=e.parent,r=e.property,a=e.entityAspect,i=e.oldValue,o=e.newValue;if(!r.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var s=a.entityManager,u=r.inverse;if(null!=o){var p=o.entityAspect;if(s){if(p.entityState.isDetached())s.isLoading||s.attachEntity(o,St.Added);else if(p.entityManager!==s)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else p&&p.entityManager&&(s=p.entityManager,s.isLoading||s.attachEntity(a.entity,St.Added))}if(u)if(u.isScalar)null!=i&&i.setProperty(u.name,null),null!=o&&o.setProperty(u.name,n);else{if(null!=i){var c=i.getProperty(u.name),l=c.indexOf(n);-1!==l&&c.splice(l,1)}if(null!=o){var y=o.getProperty(u.name);y.push(n)}}else if(r.invForeignKeyNames&&s&&!s._inKeyFixup){var f=r.invForeignKeyNames;if(null!=o){var h=n.entityAspect.getKey().values;f.forEach(function(e,t){o.setProperty(e,h[t])})}else null!=i&&f.forEach(function(e){var t=i.entityType.getProperty(e);t.isPartOfKey||i.setProperty(e,null)})}if(t(o),Q(e),r.relatedDataProperties){var d=a.entityState;if(null==o&&(d.isDetached()||i.entityAspect.entityState.isDetached()))return;if(d.isDeleted())return;var m=r.entityType.keyProperties;m.forEach(function(e,t){var a=r.relatedDataProperties[t];if(o||!a.isPartOfKey){var i=o?o.getProperty(e.name):a.defaultValue;n.setProperty(a.name,i)}})}}function G(e){var t=e.entityAspect,n=t.entityManager,r=t.entity,a={entity:r,parent:e.parent,property:e.property,propertyName:e.propertyName,oldValue:e.oldValue,newValue:e.newValue};n?n.isLoading||n.isRejectingChanges||(t.propertyChanged.publish(a),n.entityChanged.publish({entityAction:mt.PropertyChange,entity:r,args:a})):t.propertyChanged.publish(a)}function Q(e){var t=e.entityAspect,n=t.entityManager;if(null!=n&&!n.isLoading){var r=e.property;t.entityState.isUnchanged()&&!r.isUnmapped&&t.setModified(),n.validationOptions.validateOnPropertyChange&&t._validateProperty(e.newValue,{entity:t.entity,property:r,propertyName:e.propertyName,oldValue:e.oldValue})}}function J(e){return e.indexOf(":#")>=0}function H(e,t){return e+":#"+t}function Z(e,t,n){if(t)if(Array.isArray(t))t.forEach(e._addPropertyCore.bind(e));else{if("object"!=typeof t)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var r in t)if(et(t,r)){var a=t[r];a.name=r;var i=new n(a);e._addPropertyCore(i)}}}function W(e,t){var n=Array.isArray(t)?t:t.split(".");if(1===n.length)return e.getProperty(t);var r=e;return n.some(function(e){return r=r.getProperty(e),null==r}),r}function Y(e){return e&&e.isDate?function(e){return e&&e.getTime()}:e===wt.Time?function(e){return e&&F(e)}:function(e){return e}}var X={version:"1.5.1",metadataVersion:"1.0.5"},et=L(Object.prototype.hasOwnProperty),tt=L(Array.prototype.slice),nt=function(){try{return!!Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(e){return!1}}();Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t});var rt={};rt.__isES5Supported=nt,rt.objectForEach=t,rt.extend=p,rt.propEq=o,rt.pluck=s,rt.arrayEquals=T,rt.arrayFirst=v,rt.arrayIndexOf=g,rt.arrayRemoveItem=S,rt.arrayZip=w,rt.requireLib=P,rt.using=N,rt.memoize=A,rt.getUuid=C,rt.durationToSeconds=F,rt.isDate=D,rt.isGuid=k,rt.isDuration=I,rt.isFunction=M,rt.isEmpty=V,rt.isNumeric=R,rt.stringStartsWith=j,rt.stringEndsWith=K,rt.formatString=q,rt.toJSONSafe=f,rt.parent=X,X.core=rt;var at=function(){function e(e,t){return null==t?!1:"string"==typeof t&&t.length>0}function t(e,t){return null==t?!1:typeof t===e.typeName?!0:!1}function n(e,t){return null==t?!1:t instanceof e.type}function r(e,t){return null==t?!1:void 0!==t[e.propertyName]}function a(e,t){return null==t?!1:e.enumType.contains(t)}function i(e,t){return e.allowNull?void 0!==t:null!=t}function o(e,t){if(null==t)return!0;var n=e.prevContext;return n?n.fn(n,t):!0}function s(e,t){var n=e.prevContext,r=n?" or it "+l(n,t):"";return"is optional"+r}function u(e,t){if(!Array.isArray(t))return!1;if(e.mustNotBeEmpty&&0===t.length)return!1;var n=e.prevContext;return n?t.every(function(e){return n.fn(n,e)}):!0}function c(e,t){var n=e.mustNotBeEmpty?"a nonEmpty array":"an array",r=e.prevContext,a=r?" where each element "+l(r,t):"";return" must be "+n+a}function l(e,t){var n=e.msg;return"function"==typeof n&&(n=n(e,t)),n}function y(e,t){if(e._context){for(var n=e._context;null!=n.prevContext;)n=n.prevContext;if(null===n.prevContext)return n.prevContext=t,e;if(null!=t.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");t.prevContext=e._context}return f(e,t)}function f(e,t){return e._contexts[e._contexts.length-1]=t,e._context=t,e}function h(e){var t=e._contexts;return null==t[t.length-1]&&t.pop(),0===t.length?void 0:t.some(function(t){return t.fn(t,e.v)})}function d(e,t){throw new Error(q("Error configuring an instance of '%1'. %2",e&&e._$typeName||"object",t))}var m=function(e,t){this.v=e,this.name=t,this._contexts=[null]},v=m.prototype;return v.isObject=function(){return this.isTypeOf("object")},v.isBoolean=function(){return this.isTypeOf("boolean")},v.isString=function(){return this.isTypeOf("string")},v.isNonEmptyString=function(){return y(this,{fn:e,msg:"must be a nonEmpty string"})},v.isNumber=function(){return this.isTypeOf("number")},v.isFunction=function(){return this.isTypeOf("function")},v.isTypeOf=function(e){return y(this,{fn:t,typeName:e,msg:q("must be a '%1'",e)})},v.isInstanceOf=function(e,t){return t=t||e.prototype._$typeName,y(this,{fn:n,type:e,typeName:t,msg:q("must be an instance of '%1'",t)})},v.hasProperty=function(e){return y(this,{fn:r,propertyName:e,msg:q("must have a '%1' property ",e)})},v.isEnumOf=function(e){return y(this,{fn:a,enumType:e,msg:q("must be an instance of the '%1' enumeration",e.name)})},v.isRequired=function(e){return y(this,{fn:i,allowNull:e,msg:"is required"})},v.isOptional=function(){var e={fn:o,prevContext:null,msg:s};return y(this,e)},v.isNonEmptyArray=function(){return this.isArray(!0)},v.isArray=function(e){var t={fn:u,mustNotBeEmpty:e,prevContext:null,msg:c};return y(this,t)},v.or=function(){return this._contexts.push(null),this._context=null,this},v.check=function(e){var t=h(this);if(void 0!==t){if(!t)throw new Error(this.getMessage());return void 0!==this.v?this.v:e}},v._addContext=function(e){return y(this,e)},v.getMessage=function(){var e=this,t=this._contexts.map(function(t){return l(t,e.v)}).join(", or it ");return q(this.MESSAGE_PREFIX,this.name)+" "+t},v.withDefault=function(e){return this.defaultValue=e,this},v.whereParam=function(e){return this.parent.whereParam(e)},v.applyAll=function(e,t){var n=e._$typeName,r=n&&this.parent.config._$typeName===n,a=p({},this.parent.config);if(this.parent.params.forEach(function(n){r||delete a[n.name];try{n.check()}catch(i){d(e,i.message)}!t&&n._applyOne(e)}),!r)for(var i in a)void 0!==a[i]&&d(e,q("Unknown property: '%1'.",i))},v._applyOne=function(e){void 0!==this.v?e[this.name]=this.v:void 0!==this.defaultValue&&(e[this.name]=this.defaultValue)},v.MESSAGE_PREFIX="The '%1' parameter ",m}(),it=function(e,t){return new at(e,t)},ot=function(){var e=function(e){if("object"!=typeof e)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof e);this.config=e,this.params=[]},t=e.prototype;return t.whereParam=function(e){var t=new at(this.config[e],e);return t.parent=this,this.params.push(t),t},e}(),st=function(e){return new ot(e)};rt.Param=at,rt.assertParam=it,rt.assertConfig=st;var ut=function(){function e(){}var t=function(t,n){this.name=t;var r=new e(n);r.parentEnum=this,this._symbolPrototype=r,n&&Object.keys(n).forEach(function(e){r[e]=n[e]})},n=t.prototype;return t.isSymbol=function(t){return t instanceof e},n.fromName=function(e){return this[e]},n.addSymbol=function(e){var t=Object.create(this._symbolPrototype);return e&&Object.keys(e).forEach(function(n){t[n]=e[n]}),setTimeout(function(){t.getName()},0),t},n.resolveSymbols=function(){this.getSymbols().forEach(function(e){return e.getName()})},n.getSymbols=function(){return this.getNames().map(function(e){return this[e]},this)},n.getNames=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&("name"===t||"_"===t.substr(0,1)||M(this[t])||e.push(t));return e},n.contains=function(t){return t instanceof e?this[t.getName()]===t:!1},e.prototype.getName=function(){if(!this.name){var e=this;this.name=v(this.parentEnum.getNames(),function(t){return e.parentEnum[t]===e})}return this.name},e.prototype.toString=function(){return this.getName()},e.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},t}();rt.Enum=ut;var pt=function(){function e(e,n,r){var a=e._subscribers;return a?void a.forEach(function(a){try{a.callback(n)}catch(i){i.context="unable to publish on topic: "+e.name,r?r(i):e._defaultErrorCallback?e._defaultErrorCallback(i):t(i)}}):!0}function t(){}var n={},r=1,a=function(e,t,r){it(e,"eventName").isNonEmptyString().check(),it(t,"publisher").isObject().check(),this.name=e,n[e]=!0,this.publisher=t,r&&(this._defaultErrorCallback=r)},i=a.prototype;return i.publish=function(t,n,r){return a._isEnabled(this.name,this.publisher)?(n===!0?setTimeout(e,0,this,t,r):e(this,t,r),!0):!1},i.publishAsync=function(e,t){this.publish(e,!0,t)},i.subscribe=function(e){this._subscribers||(this._subscribers=[]);var t=r;return this._subscribers.push({unsubKey:t,callback:e}),++r,t},i.unsubscribe=function(e){if(!this._subscribers)return!1;var t=this._subscribers,n=g(t,function(t){return t.unsubKey===e});return-1!==n?(t.splice(n,1),0===t.length&&(this._subscribers=null),!0):!1},i.clear=function(){this._subscribers=null},a.bubbleEvent=function(e,t){e._getEventParent=t},a.enable=function(e,t,n){it(e,"eventName").isNonEmptyString().check(),it(t,"obj").isObject().check(),it(n,"isEnabled").isBoolean().isOptional().or().isFunction().check(),t._$eventMap||(t._$eventMap={}),t._$eventMap[e]=n},a.isEnabled=function(e,t){if(it(e,"eventName").isNonEmptyString().check(),it(t,"obj").isObject().check(),!t._getEventParent)throw new Error("This object does not support event enabling/disabling");return a._isEnabled(t,e)},a._isEnabled=function(e,t){var n=null,r=t._$eventMap;if(r&&(n=r[e]),null!=n)return"function"==typeof n?n(t):!!n;var i=t._getEventParent&&t._getEventParent();return i?a._isEnabled(e,i):!0},a}();rt.Event=pt;var ct=function(){function e(e,t,n){var r=t.defaultInstance;return r||(r=new t.ctor,t.defaultInstance=r,r._$impl=t),r.initialize(),n&&(e.defaultInstance=r),a.interfaceInitialized.publish({interfaceName:e.name,instance:r,isDefault:!0}),r.checkForRecomposition&&a.interfaceInitialized.subscribe(function(e){r.checkForRecomposition(e)}),r}function t(e){var t=e.toLowerCase(),r=n(a.interfaceRegistry||{},function(e){return e.toLowerCase()===t});if(!r)throw new Error("Unknown interface name: "+e);return r.value}var a={};a.functionRegistry={},a.typeRegistry={},a.objectRegistry={},a.interfaceInitialized=new pt("interfaceInitialized",a);var i=function(e){this.name=e,this.defaultInstance=null,this._implMap={}};return i.prototype.registerCtor=function(e,t){this._implMap[e.toLowerCase()]={ctor:t,defaultInstance:null}},i.prototype.getImpl=function(e){return this._implMap[e.toLowerCase()]},i.prototype.getFirstImpl=function(){var e=n(this._implMap,function(){return!0});return e?e.value:null},a.interfaceRegistry={ajax:new i("ajax"),modelLibrary:new i("modelLibrary"),dataService:new i("dataService")},a.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},a.setProperties=function(e){st(e).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(e),e.remoteAccessImplementation&&a.initializeAdapterInstance("dataService",e.remoteAccessImplementation),e.trackingImplementation&&a.initializeAdapterInstance("modelLibrary",e.trackingImplementation),e.ajaxImplementation&&a.initializeAdapterInstance("ajax",e.ajaxImplementation)},a.registerAdapter=function(e,n){it(e,"interfaceName").isNonEmptyString().check(),it(n,"adapterCtor").isFunction().check();var r=new n,a=r.name;if(!a)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var i=t(e);i.registerCtor(a,n)},a.getAdapter=function(e,n){var r=t(e);if(n){var a=r.getImpl(n);return a?a.ctor:null}return r.defaultInstance?r.defaultInstance._$impl.ctor:null},a.initializeAdapterInstances=function(e){return st(e).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().applyAll(this,!1),r(e,a.initializeAdapterInstance)},a.initializeAdapterInstance=function(n,r,a){a=void 0===a?!0:a,it(n,"interfaceName").isNonEmptyString().check(),it(r,"adapterName").isNonEmptyString().check(),it(a,"isDefault").isBoolean().check();var i=t(n),o=i.getImpl(r);if(!o)throw new Error("Unregistered adapter.  Interface: "+n+" AdapterName: "+r);return e(i,o,a)},a.getAdapterInstance=function(n,r){var a,i=t(n);return r&&""!==r?(a=i.getImpl(r),a?a.defaultInstance:null):i.defaultInstance?i.defaultInstance:(a=i.getFirstImpl(),a.defaultInstance?a.defaultInstance:e(i,a,!0))},a.registerFunction=function(e,t){it(e,"fn").isFunction().check(),it(t,"fnName").isString().check(),e.prototype._$fnName=t,a.functionRegistry[t]=e},a._storeObject=function(e,t,n){var r=("string"==typeof t?t:t.prototype._$typeName)+"."+n;a.objectRegistry[r]=e},a._fetchObject=function(e,t){if(!t)return void 0;var n=("string"==typeof e?e:e.prototype._$typeName)+"."+t,r=a.objectRegistry[n];if(!r)throw new Error("Unable to locate a registered object by the name: "+n);return r},a.registerType=function(e,t){it(e,"ctor").isFunction().check(),it(t,"typeName").isString().check(),e.prototype._$typeName=t,a.typeRegistry[t]=e},a.stringifyPad="",a}(),lt=ct.interfaceRegistry.modelLibrary;rt.config=ct,X.config=ct;var yt=function(){function e(e){var t=e.getEntityAspect();t.entityState.isUnchanged()&&t.setModified(),t.entityState.isModified()&&!e._origValues&&(e._origValues=e.slice(0))}function t(e,t){e._processAdds(t),r(e,"arrayChanged",{array:e,added:t})}function n(e,t){e._processRemoves(t),r(e,"arrayChanged",{array:e,removed:t})}function r(e,t,n){var r=e._getPendingPubs();r?e._pendingArgs?a(e._pendingArgs,n):(e._pendingArgs=n,r.push(function(){e[t].publish(e._pendingArgs),e._pendingArgs=null})):e[t].publish(n)}function a(e,t){for(var n in t)if("array"!==n&&e.hasOwnProperty(n)){var r=t[n],a=e[n];if(a){if(!Array.isArray(a))throw new Error("Cannot combine non array args");Array.prototype.push.apply(a,r)}else e[n]=r}}function i(e,t,n){e.parent=t,e.parentProperty=n}var o={};return o.push=function(){if(this._inProgress)return-1;var e=this._getGoodAdds(tt(arguments));if(!e.length)return this.length;this._beforeChange();var n=Array.prototype.push.apply(this,e);return t(this,e),n},o._push=function(){if(this._inProgress)return-1;var e=tt(arguments);this._beforeChange();var n=Array.prototype.push.apply(this,e);return t(this,e),n},o.unshift=function(){var e=this._getGoodAdds(tt(arguments));if(!e.length)return this.length;this._beforeChange();var n=Array.prototype.unshift.apply(this,e);return t(this,tt(e)),n},o.pop=function(){this._beforeChange();var e=Array.prototype.pop.apply(this);return n(this,[e]),e},o.shift=function(){this._beforeChange();var e=Array.prototype.shift.apply(this);return n(this,[e]),e},o.splice=function(){var e=this._getGoodAdds(tt(arguments,2)),r=tt(arguments,0,2).concat(e);this._beforeChange();var a=Array.prototype.splice.apply(this,r);return n(this,a),e.length&&t(this,e),a},o.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},o._getEventParent=function(){return this.getEntityAspect()},o._getPendingPubs=function(){var e=this.getEntityAspect().entityManager;return e&&e._pendingPubs},o._beforeChange=function(){},{mixin:o,publish:r,updateEntityState:e,initializeParent:i}}(),ft=function(){function e(e,t,n,r,a){for(r=+e[t=e.length-1],a=0;t--;)n=+e[t],r+=++a%2?2*n%10+(n>4):n;return!(r%10)}function n(e,t,n,r){n&&(f.messageTemplates[e]=n);var a="string"==typeof t?new RegExp(t):t,i=function(e){return null==e||""===e?!0:"string"!=typeof e?!1:a.test(e)};return new f(e,i,r)}function r(e,t,n){return t?e.replace(/%([^%]+)%/g,function(e,r){var a;return a=n?t.hasOwnProperty(r)?t[r]:"":t[r],null!=a?M(a)?a(t):a:""}):e}function a(e,t,n,r){var a=r&&r.messageTemplate||f.messageTemplates[e];return a||(f.messageTemplates[e]=q("'%displayName%' must be an integer between the values of %1 and %2",t,n)),function(){var a=function(e,r){return null==e?!0:("string"==typeof e&&r&&r.allowString&&(e=parseInt(e,0)),"number"!=typeof e||isNaN(e)||Math.floor(e)!==e?!1:null!=t&&t>e?!1:null!=n&&e>n?!1:!0)};return new f(e,a,r)}}var i=-32768,o=32767,s=-2147483648,u=2147483647,c=0,l=255,y={displayName:function(e){return e.property?e.property.resolveProperty("displayName")||e.propertyName||e.property.name:"Value"}},f=function(e,t,n){this._baseContext=n||{},this._baseContext.name=e,n=p(Object.create(y),this._baseContext),n.messageTemplate=n.messageTemplate||f.messageTemplates[e],this.name=e,this.valFn=t,this.context=n},h=f.prototype;return h._$typeName="Validator",h.validate=function(e,t){var n;n=t?p(Object.create(this.context),t):this.context,this.currentContext=n;try{return this.valFn(e,n)?null:(n.value=e,new ht(this,n,this.getMessage()))}catch(r){return new ht(this,n,"Exception occured while executing this validator: "+this.name)}},h.getMessage=function(){try{var e=this.currentContext,t=e.message;return t?"function"==typeof t?t(e):t:e.messageTemplate?r(e.messageTemplate,e):"invalid value: "+(this.name||"{unnamed validator}")}catch(n){return"Unable to format error message"+n.toString()}},h.toJSON=function(){return this._baseContext},f.fromJSON=function(e){if(Array.isArray(e))return e.map(function(e){return f.fromJSON(e)});var t="Validator."+e.name,n=ct.functionRegistry[t];if(!n)throw new Error("Unable to locate a validator named:"+e.name);return n(e)},f.register=function(e){ct.registerFunction(function(){return e},"Validator."+e.name)},f.registerFactory=function(e,t){ct.registerFunction(e,"Validator."+t)},f.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},f.required=function(e){var t=function(e,t){return"string"==typeof e?t&&t.allowEmptyStrings?!0:e.length>0:null!=e};return new f("required",t,e)},f.maxLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:e.length<=t.maxLength};return new f("maxLength",t,e)},f.stringLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:null!=t.minLength&&e.length<t.minLength?!1:null!=t.maxLength&&e.length>t.maxLength?!1:!0};return new f("stringLength",t,e)},f.string=function(){var e=function(e){return null==e?!0:"string"==typeof e};return new f("string",e)},f.guid=function(){var e=function(e){return null==e?!0:k(e)};return new f("guid",e)},f.duration=function(){var e=function(e){return null==e?!0:I(e)};return new f("duration",e)},f.number=f.double=f.single=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseFloat(e,10)),"number"==typeof e&&!isNaN(e))};return new f("number",t,e)},f.integer=f.int64=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseInt(e,10)),"number"==typeof e&&!isNaN(e)&&Math.floor(e)===e)};return new f("integer",t,e)},f.int32=function(e){return a("int32",s,u,e)()},f.int16=function(e){return a("int16",i,o,e)()},f.byte=function(e){return a("byte",c,l,e)()},f.bool=function(){var e=function(e){return null==e?!0:e===!0||e===!1};return new f("bool",e)},f.none=function(){var e=function(){return!0};return new f("none",e)},f.date=function(){var e=function(e){if(null==e)return!0;if("string"!=typeof e)return D(e);try{return!isNaN(Date.parse(e))}catch(t){return!1}};return new f("date",e)},f.creditCard=function(t){function n(t){return null==t||""===t?!0:"string"!=typeof t?!1:(t=t.replace(/(\-|\s)/g,""),!t||/\D/.test(t)?!1:e(t))}return new f("creditCard",n,t)},f.regularExpression=function(e){function t(e,t){if(null==e||""===e)return!0;if("string"!=typeof e)return!1;try{var n=new RegExp(t.expression)}catch(r){throw new Error("Missing or invalid expression parameter to regExp validator")}return n.test(e)}return new f("regularExpression",t,e)},f.emailAddress=function(e){var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;return n("emailAddress",t,null,e)},f.phone=function(e){var t=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return n("phone",t,null,e)},f.url=function(e){var t=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;
return n("url",t,null,e)},f.makeRegExpValidator=n,t(f,function(e,t){"function"==typeof t&&"fromJSON"!==e&&"register"!==e&&"registerFactory"!==e&&"makeRegExpValidator"!==e&&ct.registerFunction(t,"Validator."+e)}),f}(),ht=function(){var e=function(e,t,n,r){it(e,"validator").isOptional().isInstanceOf(ft).check(),it(n,"errorMessage").isNonEmptyString().check(),it(r,"key").isOptional().isNonEmptyString().check(),this.validator=e,t=t||{},this.context=t,this.errorMessage=n,this.property=t.property,this.propertyName=t.propertyName||t.property&&t.property.name,this.key=r?r:ht.getKey(e||n,this.propertyName),this.isServerError=!1};return e.getKey=function(e,t){return(e.name||e)+(t?":"+t:"")},e}();X.Validator=ft,X.ValidationError=ht;var dt=function(){function e(e,t){return t&&st(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="ValidationOptions",n.using=function(t){if(!t)return this;var n=new dt(this);return e(n,t),n},n.setAsDefault=function(){return l(this,t)},t.defaultInstance=new t({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),t}();X.ValidationOptions=dt,X.makeComplexArray=function(){function e(e,t){return t.filter(function(t){return t.parent!==e.parent})}function t(e,t){t.forEach(function(t){if(null!=t.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");a(t,e)})}function n(e,t){t.forEach(function(t){r(t,e)})}function r(e,t){var n=e.complexAspect;return n.parent!==t.parent?null:(n.parent=null,n.parentProperty=null,n)}function a(e,t){var n=e.complexAspect;return n.parent===t.parent?null:(n.parent=t.parent,n.parentProperty=t.parentProperty,n)}function i(e,t,n){return yt.initializeParent(e,t,n),e.arrayChanged=new pt("arrayChanged",e),p(e,yt.mixin),p(e,o)}var o={};return o._getGoodAdds=function(t){return e(this,t)},o._beforeChange=function(){yt.updateEntityState(this)},o._processAdds=function(e){t(this,e)},o._processRemoves=function(e){n(this,e)},o._rejectChanges=function(){if(this._origValues){var e=this;this.forEach(function(t){r(t,e)}),this.length=0,this._origValues.forEach(function(t){e.push(t)}),Array.prototype.push.apply(this,this._origValues)}},o._acceptChanges=function(){this._origValues=null},i}();var mt=function(){var e={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},t=new ut("EntityAction",e);return t.Attach=t.addSymbol({isAttach:!0}),t.AttachOnQuery=t.addSymbol({isAttach:!0}),t.AttachOnImport=t.addSymbol({isAttach:!0}),t.Detach=t.addSymbol({isDetach:!0}),t.MergeOnQuery=t.addSymbol({isModification:!0}),t.MergeOnImport=t.addSymbol({isModification:!0}),t.MergeOnSave=t.addSymbol({isModification:!0}),t.PropertyChange=t.addSymbol({isModification:!0}),t.EntityStateChange=t.addSymbol(),t.AcceptChanges=t.addSymbol(),t.RejectChanges=t.addSymbol({isModification:!0}),t.Clear=t.addSymbol({isDetach:!0}),t.resolveSymbols(),t}();X.EntityAction=mt;var vt=function(){function e(t){var n=t.entityAspect||t.complexAspect,r=t.entityType||t.complexType,a=n.originalValues;for(var i in a)t.setProperty(i,a[i]);r.complexProperties.forEach(function(n){var r=t.getProperty(n.name);n.isScalar?e(r):(r._rejectChanges(),r.forEach(function(t){e(t)}))})}function n(e){var t=e.entityAspect||e.complexAspect;t.originalValues={};var r=e.entityType||e.complexType;r.complexProperties.forEach(function(t){var r=e.getProperty(t.name);t.isScalar?n(r):(r._acceptChanges(),r.forEach(function(e){n(e)}))})}function r(e,t){var n=!0,a=e.entityType||e.complexType,i=e.entityAspect||e.complexAspect,s=e.entityAspect||e.complexAspect.getEntityAspect(),u={entity:s.entity};return void 0!==t&&(u.index=t),a.getProperties().forEach(function(t){var a=e.getProperty(t.name),o=t.getAllValidators();o.length>0&&(u.property=t,u.propertyName=i.getPropertyPath(t.name),n=s._validateProperty(a,u)&&n),t.isComplexProperty&&(n=t.isScalar?r(a)&&n:a.reduce(function(e,t,n){return r(t,n)&&e},n))}),a.getAllValidators().forEach(function(t){n=o(s,t,e)&&n}),n}function a(e,t){var n=t.isDeleted();n?i(e):N(e.entityAspect.entityManager,"isLoading",!0,function(){i(e)})}function i(e){e.entityType.navigationProperties.forEach(function(t){var n=t.inverse,r=e.getProperty(t.name);if(t.isScalar){if(r){if(n)if(n.isScalar)r.setProperty(n.name,null);else{var a=r.getProperty(n.name);a.length&&S(a,e)}e.setProperty(t.name,null)}}else n&&r.slice(0).forEach(function(e){n.isScalar&&e.setProperty(n.name,null)}),r.length=0})}function o(e,t,n,r){var a=t.validate(n,r);if(a)return e._addValidationError(a),!1;var i=ht.getKey(t,r?r.propertyName:null);return e._removeValidationError(i),!0}var s=function(e){if(null===e){var t=vt._nullInstance;if(t)return t;vt._nullInstance=this}else{if(void 0===e)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(e.entityAspect)return e.entityAspect}if(!(this instanceof vt))return new vt(e);if(this.entity=e,this.entityGroup=null,this.entityManager=null,this.entityState=St.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new pt("validationErrorsChanged",this),this.propertyChanged=new pt("propertyChanged",this),null!=e){e.entityAspect=this;var n=e.entityType||e._$entityType;if(!n){var r=e.prototype._$typeName;throw new Error(r?"Metadata for this entityType has not yet been resolved: "+r:"This entity is not registered as a valid EntityType")}var a=n.getEntityCtor();lt.getDefaultInstance().startTracking(e,a.prototype)}},p=s.prototype;return pt.bubbleEvent(p,function(){return this.entityManager}),p.getKey=function(e){if(e=it(e,"forceRefresh").isBoolean().isOptional().check(!1),e||!this._entityKey){var t=this.entity.entityType,n=t.keyProperties,r=n.map(function(e){return this.entity.getProperty(e.name)},this);this._entityKey=new Et(t,r)}return this._entityKey},p.acceptChanges=function(){var e=this.entityManager;this.entityState.isDeleted()?e.detachEntity(this.entity):this.setUnchanged(),e.entityChanged.publish({entityAction:mt.AcceptChanges,entity:this.entity})},p.rejectChanges=function(){var t=this.entity,n=this.entityManager;N(n,"isRejectingChanges",!0,function(){e(t)}),this.entityState.isAdded()?(n.detachEntity(t),n._notifyStateChange(t,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(t),this.setUnchanged(),this.propertyChanged.publish({entity:t,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:mt.RejectChanges,entity:t}))},p.getPropertyPath=function(e){return e},p.setAdded=function(){return this.setEntityState(St.Added)},p.setUnchanged=function(){return this.setEntityState(St.Unchanged)},p.setModified=function(){return this.setEntityState(St.Modified)},p.setDeleted=function(){return this.setEntityState(St.Deleted)},p.setDetached=function(){return this.setEntityState(St.Detached)},p.setEntityState=function(e){if(this.entityState===e)return!1;if(this.entityState.isDetached())throw new Error("You cannot set the 'entityState' of an entity when it is detached - except by first attaching it to an EntityManager");var t=this.entity,r=this.entityManager,i=!0;if(e===St.Unchanged)n(t),delete this.hasTempKey,i=!1;else if(e===St.Added)n(t);else if(e===St.Deleted){if(this.entityState.isAdded())return this.setEntityState(St.Detached),!0;this.entityState=St.Deleted,a(t,St.Deleted)}else if(e===St.Modified);else if(e===St.Detached){var o=this.entityGroup;if(!o)return!1;o.detachEntity(t),this.entityState=e,a(t,St.Detached),this._detach(),r.entityChanged.publish({entityAction:mt.Detach,entity:t}),i=!1}return this.entityState=e,r._notifyStateChange(t,i),!0},p.loadNavigationProperty=function(e,t,n){var r=this.entity,a=r.entityType._checkNavProperty(e),i=It.fromEntityNavigation(r,a),o=r.entityAspect.entityManager.executeQuery(i),s=this;return o.then(function(e){return s._markAsLoaded(a.name),t&&t(e),Pt.resolve(e)},function(e){return n&&n(e),Pt.reject(e)})},p.markNavigationPropertyAsLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);this._markAsLoaded(t.name)},p.isNavigationPropertyLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);return t.isScalar&&null!=this.entity.getProperty(t.name)?!0:this._loadedNps&&this._loadedNps.indexOf(t.name)>=0},p._markAsLoaded=function(e){this._loadedNps=this._loadedNps||[],E(this._loadedNps,e)},p.validateEntity=function(){var e=!0;return this._processValidationOpAndPublish(function(t){e=r(t.entity)}),e},p.validateProperty=function(e,t){var n=this.getPropertyValue(e);return n&&n.complexAspect?r(n):(t=t||{},t.entity=this.entity,"string"==typeof e?(t.property=this.entity.entityType.getProperty(e,!0),t.propertyName=e):(t.property=e,t.propertyName=e.name),this._validateProperty(n,t))},p.getValidationErrors=function(e){it(e,"property").isOptional().isEntityProperty().or().isString().check();var t=u(this._validationErrors);if(e){var n="string"==typeof e?e:e.name;t=t.filter(function(e){return e.property&&(e.property.name===n||-1!=n.indexOf(".")&&e.propertyName==n)})}return t},p.addValidationError=function(e){it(e,"validationError").isInstanceOf(ht).check(),this._processValidationOpAndPublish(function(t){t._addValidationError(e)})},p.removeValidationError=function(e){it(e,"validationErrorOrKey").isString().or().isInstanceOf(ht).or().isInstanceOf(ft).check();var t="string"==typeof e?e:e.key;this._processValidationOpAndPublish(function(e){e._removeValidationError(t)})},p.clearValidationErrors=function(){this._processValidationOpAndPublish(function(e){t(e._validationErrors,function(t,n){n&&(delete e._validationErrors[t],e._pendingValidationResult.removed.push(n))}),e.hasValidationErrors=!V(e._validationErrors)})},p.getParentKey=function(e){var t=e.foreignKeyNames;if(0===t.length)return null;var n=this,r=t.map(function(e){return n.entity.getProperty(e)});return new Et(e.entityType,r)},p.getPropertyValue=function(e){it(e,"property").isString().or().isEntityProperty().check();var t;if("string"==typeof e){var n=e.trim().split("."),r=n.shift();for(t=this.entity,t=t.getProperty(r);n.length>0;)r=n.shift(),t=t.getProperty(r)}else{if(!(e.parentType instanceof Ot))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");t=this.entity.getProperty(e.name)}return t},p._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=St.Detached,this.originalValues={},this._validationErrors={},this.hasValidationErrors=!1,this.validationErrorsChanged.clear(),this.propertyChanged.clear()},p._validateProperty=function(e,t){var n=!0;return this._processValidationOpAndPublish(function(r){t.property.getAllValidators().forEach(function(a){n=o(r,a,e,t)&&n})}),n},p._processValidationOpAndPublish=function(e){if(this._pendingValidationResult)e(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},e(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},p._addValidationError=function(e){this._validationErrors[e.key]=e,this.hasValidationErrors=!0,this._pendingValidationResult.added.push(e)},p._removeValidationError=function(e){var t=this._validationErrors[e];t&&(delete this._validationErrors[e],this.hasValidationErrors=!V(this._validationErrors),this._pendingValidationResult.removed.push(t))},s}(),gt=function(){var e=function(e,t,n){if(!e)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(e.complexAspect)return e.complexAspect;if(!(this instanceof gt))return new gt(e,t,n);this.complexObject=e,e.complexAspect=this,this.originalValues={},null!=t&&(this.parent=t,this.parentProperty=n);var r=e.complexType;if(!r){var a=e.prototype._$typeName;throw new Error(a?"Metadata for this complexType has not yet been resolved: "+a:"This entity is not registered as a valid ComplexType")}var i=r.getCtor();lt.getDefaultInstance().startTracking(e,i.prototype)},t=e.prototype;return t.getEntityAspect=function(){var e=this.parent;if(!e)return new vt(null);for(var t=e.entityAspect;e&&!t;)e=e.complexAspect&&e.complexAspect.parent,t=e&&e.entityAspect;return t||new vt(null)},t.getPropertyPath=function(e){var t=this.parent;if(!t)return null;var n=t.complexAspect||t.entityAspect;return n.getPropertyPath(this.parentProperty.name+"."+e)},e}();X.EntityAspect=vt,X.ComplexAspect=gt;var Et=function(){function e(e){return e.join(t)}var t=":::",n=function(t,n){it(t,"entityType").isInstanceOf(Ot).check();var r=t.getSelfAndSubtypes();r.length>1&&(this._subtypes=r.filter(function(e){return e.isAbstract===!1})),Array.isArray(n)||(n=tt(arguments,1)),this.entityType=t,t.keyProperties.forEach(function(e,t){e.dataType===wt.Guid&&(n[t]=n[t]&&n[t].toLowerCase())}),this.values=n,this._keyInGroup=e(n)};n._$typeName="EntityKey";var r=n.prototype;return r.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},n.fromJSON=function(e,t){var n=t._getEntityType(e.entityType,!0);return new Et(n,e.values)},r.equals=function(e){return e instanceof Et?this.entityType===e.entityType&&T(this.values,e.values):!1},r.toString=function(e){return(e||this.entityType).name+"-"+this._keyInGroup},n.equals=function(e,t){return e instanceof Et?e.equals(t):!1},r._isEmpty=function(){return 0===this.values.join("").length},n.createKeyString=e,n}();X.EntityKey=Et;var St=function(){var e={isUnchanged:function(){return this===t.Unchanged},isAdded:function(){return this===t.Added},isModified:function(){return this===t.Modified},isDeleted:function(){return this===t.Deleted},isDetached:function(){return this===t.Detached},isUnchangedOrModified:function(){return this===t.Unchanged||this===t.Modified},isAddedModifiedOrDeleted:function(){return this===t.Added||this===t.Modified||this===t.Deleted}},t=new ut("EntityState",e);return t.Unchanged=t.addSymbol(),t.Added=t.addSymbol(),t.Modified=t.addSymbol(),t.Deleted=t.addSymbol(),t.Detached=t.addSymbol(),t.resolveSymbols(),t}();X.EntityState=St,X.makePrimitiveArray=function(){function e(e,n,r){return yt.initializeParent(e,n,r),e.arrayChanged=new pt("arrayChanged",e),p(e,yt.mixin),p(e,t)}var t={};return t._getGoodAdds=function(e){return e},t._beforeChange=function(){var e=this.getEntityAspect();e.entityState.isUnchanged()&&e.setModified(),e.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},t._processAdds=function(){},t._processRemoves=function(){},t._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},t._acceptChanges=function(){this._origValues=null},e}(),X.makeRelationArray=function(){function e(e,t){var n=r(e,t);if(!n.length)return n;var a=e.parentEntity,i=a.entityAspect.entityManager;return i&&!i.isLoading&&n.forEach(function(t){if(t.entityAspect.entityState.isDetached()){e._inProgress=!0;try{i.attachEntity(t,St.Added)}finally{e._inProgress=!1}}}),n}function t(e,t){var n=e.parentEntity,r=e.navigationProperty,a=e._addsInProcess,i=r.inverse,o=a.length;try{t.forEach(function(e){if(a.push(e),i)e.setProperty(i.name,n);else{var t=n.entityType.keyProperties;r.invForeignKeyNames.forEach(function(r,a){e.setProperty(r,n.getProperty(t[a].name))})}})}finally{a.splice(o,t.length)}}function n(e,t){var n=e.navigationProperty.inverse;n&&t.forEach(function(e){e.setProperty(n.name,null)})}function r(e,t){var n,r=e.parentEntity,a=e.navigationProperty,i=a.inverse;if(i)n=t.filter(function(t){if(e._addsInProcess.indexOf(t)>=0)return!1;var n=t.getProperty(i.name);return n!==r});else{var o=a.invForeignKeyNames,s=r.entityType.keyProperties;n=t.filter(function(t){return e._addsInProcess.indexOf(t)>=0?!1:o.some(function(e,n){var a=s[n].name,i=r.getProperty(a),o=t.getProperty(e);return i!==o})})}return n}function a(e,t,n){return e.parentEntity=t,e.navigationProperty=n,e.arrayChanged=new pt("arrayChanged",e),e._addsInProcess=[],p(e,yt.mixin),p(e,i)}var i={};return i.load=function(e,t){var n=this.parentEntity,r=It.fromEntityNavigation(this.parentEntity,this.navigationProperty),a=n.entityAspect.entityManager;return a.executeQuery(r,e,t)},i._getEventParent=function(){return this.parentEntity.entityAspect},i._getPendingPubs=function(){var e=this.parentEntity.entityAspect.entityManager;return e&&e._pendingPubs},i._getGoodAdds=function(t){return e(this,t)},i._processAdds=function(e){t(this,e)},i._processRemoves=function(e){n(this,e)},a}();var wt=function(){function e(e,t){throw e=q(e,t),new Error(e)}function t(e){switch(e){case P.String:return ft.string;case P.Int64:return ft.int64;case P.Int32:return ft.int32;case P.Int16:return ft.int16;case P.Decimal:return ft.number;case P.Double:return ft.number;case P.Single:return ft.number;case P.DateTime:return ft.date;case P.DateTimeOffset:return ft.date;case P.Boolean:return ft.bool;case P.Guid:return ft.guid;case P.Byte:return ft.byte;case P.Binary:return ft.none;case P.Time:return ft.duration;case P.Undefined:return ft.none}}var n,r={},a=function(){n={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1}};a();var i=function(){return n.stringPrefix+o().toString()},o=function(){var e=n.nextNumber;return n.nextNumber+=n.nextNumberIncrement,e},s=function(){return C()},u=function(){return new Date},p=function(e){return null==e?e:e.toString()},c=function(e,t){if("string"===t){var n=e.trim();if(""===n)return null;var r=parseInt(n,10);return isNaN(r)?e:r}return"number"===t?Math.round(e):e},l=function(e,t){if("string"===t){var n=e.trim();if(""===n)return null;var r=parseFloat(n);return isNaN(r)?e:r}return e},y=function(e,t){var n;if("string"===t){var r=e.trim();return""===r?null:(n=new Date(Date.parse(r)),D(n)?n:e)}return"number"===t?(n=new Date(e),D(n)?n:e):e},f=function(e,t){if("string"===t){var n=e.trim().toLowerCase();return"false"===n||""===n?!1:"true"===n?!0:e}return e},h=function(e){return null==e?null:"'"+e.replace(/'/g,"''")+"'"},d=function(e){return null==e?null:"string"==typeof e?parseInt(e,10):e},m=function(e){return function(t){return null==t?null:("string"==typeof t&&(t=parseFloat(t)),t+e)}},v=function(t){if(null==t)return null;try{return"datetime'"+t.toISOString()+"'"}catch(n){e("'%1' is not a valid dateTime",t)}},g=function(t){if(null==t)return null;try{return"datetimeoffset'"+t.toISOString()+"'"}catch(n){e("'%1' is not a valid dateTime",t)}},E=function(t){return null==t?null:(I(t)||e("'%1' is not a valid ISO 8601 duration",t),"time'"+t+"'")},S=function(t){return null==t?null:(k(t)||e("'%1' is not a valid guid",t),"guid'"+t+"'")},w=function(e){return null==e?null:"string"==typeof e?"true"===e.trim().toLowerCase():!!e},T=function(e){return null==e?e:"binary'"+e+"'"},_=function(e){return e},P=new ut("DataType",r);P.String=P.addSymbol({defaultValue:"",parse:p,fmtOData:h,getNext:i}),P.Int64=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:c,fmtOData:m("L"),getNext:o}),P.Int32=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:c,fmtOData:d,getNext:o}),P.Int16=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:c,fmtOData:d,getNext:o}),P.Byte=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:c,fmtOData:d}),P.Decimal=P.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,isFloat:!0,parse:l,fmtOData:m("m"),getNext:o}),P.Double=P.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:l,fmtOData:m("d"),getNext:o}),P.Single=P.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:l,fmtOData:m("f"),getNext:o}),P.DateTime=P.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:v,getNext:u}),P.DateTimeOffset=P.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:g,getNext:u}),P.Time=P.addSymbol({defaultValue:"PT0S",fmtOData:E}),P.Boolean=P.addSymbol({defaultValue:!1,parse:f,fmtOData:w}),P.Guid=P.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:S,getNext:s}),P.Binary=P.addSymbol({defaultValue:null,fmtOData:T}),P.Undefined=P.addSymbol({defaultValue:void 0,fmtOData:_}),P.resolveSymbols(),P.fromEdmDataType=function(e){var t=null,n=e.split(".");if(n.length>1){var r=n[1];t="image"===r?P.Byte:2===n.length?P.fromName(r)||P.Undefined:P.String}return t},P.fromValue=function(e){if(D(e))return P.DateTime;switch(typeof e){case"string":return k(e)?P.Guid:I(e)&&e.length>3?P.Time:P.String;case"boolean":return P.Boolean;case"number":return P.Double}return P.Undefined};var b=/.\d{3}$/;return P.parseTimeFromServer=function(e){if("string"==typeof e)return e;if(e&&"Edm.Time"===e.__edmType){var t=Math.floor(e.ms/1e3);return"PT"+t+"S"}return e},P.parseDateAsUTC=function(e){if("string"==typeof e){var t=b.test(e);e=t?e+"Z":e}return e=new Date(Date.parse(e))},P.parseDateFromServer=P.parseDateAsUTC,P.parseRawValue=function(e,t){return void 0===e?void 0:(t.isDate&&e?D(e)||(e=P.parseDateFromServer(e)):t===P.Binary?e&&void 0!==e.$value&&(e=e.$value):t===P.Time&&(e=P.parseTimeFromServer(e)),e)},P.constants=n,P._resetConstants=a,P.getSymbols().forEach(function(e){e.validatorCtor=t(e)}),P}();X.DataType=wt;var Tt=function(){function e(e,t){return t&&(st(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(_t).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(e),e.serviceName=e.serviceName&&Tt._normalizeServiceName(e.serviceName),e.adapterInstance=e.adapterName&&ct.getAdapterInstance("dataService",e.adapterName)),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="DataService",n.using=function(t){if(!t)return this;var n=new Tt(this);return e(n,t)},t.resolve=function(e){e.push({hasServerMetadata:!0,useJsonp:!1});var t=new Tt(h(e,["serviceName","adapterName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return t.adapterInstance=t.adapterInstance||ct.getAdapterInstance("dataService",t.adapterName),t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter,t},t._normalizeServiceName=function(e){return e=e.trim(),"/"!==e.substr(-1)?e+"/":e},n.toJSON=function(){return y(this,{serviceName:null,adapterName:null,hasServerMetadata:null,jsonResultsAdapter:function(e){return e&&e.name},useJsonp:null})},t.fromJSON=function(e){return e.jsonResultsAdapter=ct._fetchObject(_t,e.jsonResultsAdapter),new Tt(e)},n.makeUrl=function(e){var t=this.serviceName;return rt.stringEndsWith(t,"/")&&(t=t.substr(0,t.length-1)),e="/"+e,rt.stringEndsWith(t,e)||(t+=e),t},t}(),_t=function(){function e(e){return e.results}var t=function(t){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");st(t).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(e).whereParam("visitNode").isFunction().applyAll(this),ct._storeObject(this,n._$typeName,this.name)},n=t.prototype;return n._$typeName="JsonResultsAdapter",t}();X.DataService=Tt,X.JsonResultsAdapter=_t;var Pt=b("Q");Pt||(Pt=function(){var e="Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q";throw new Error(e)},Pt.defer=Pt.resolve=Pt.reject=Pt),X.config.setQ=function(e){X.Q=Pt=e},X.Q=Pt;var bt=function(){function e(e){var t=[];for(var n in e){var r=e[n];n===r.name&&t.push(e[n])}return t}function t(e,t,r){var a=H(t.shortName,t.namespace),o=e._getEntityType(a,!0);if(o)return r?n(o,t):o;var s={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:xt.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName,custom:t.custom};if(o=t.isComplexType?new At(s):new Ot(s),t.baseTypeName){o.baseTypeName=t.baseTypeName;var u=e._getEntityType(t.baseTypeName,!0);u?i(e,t,o,u):_(e._deferredTypes,t.baseTypeName).push({json:t,stype:o})}else i(e,t,o);return o}function n(e,t){return t.custom&&(e.custom=t.custom),a(e,t.dataProperties),a(e,t.navigationProperties),e}function a(e,t){t&&t.forEach(function(t){var n=t.name;if(!n){if(!t.nameOnServer)throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");n=e.metadataStore.namingConvention.serverPropertyNameToClient(t.nameOnServer,{})}if(t.custom){var r=e.getProperty(n,!0);r.custom=t.custom}})}function i(e,t,n){t.validators&&(n.validators=t.validators.map(ft.fromJSON)),t.dataProperties.forEach(function(e){n._addPropertyCore(Ct.fromJSON(e))});var r=!t.isComplexType;r&&t.navigationProperties&&t.navigationProperties.forEach(function(e){n._addPropertyCore(Ft.fromJSON(e))}),e.addEntityType(n);var a=e._deferredTypes,o=a[n.name];o&&(o.forEach(function(t){i(e,t.json,t.stype)}),delete a[n.name])}function o(e,t,n){if(J(t))return t;var r=e._shortNameMap[t];if(!r&&n)throw new Error("Unable to locate 'entityTypeName' of: "+t);return r}var s=0,u=function(e){e=e||{},st(e).whereParam("namingConvention").isOptional().isInstanceOf(kt).withDefault(kt.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(Mt).withDefault(Mt.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=s++,this.metadataFetched=new pt("metadataFetched",this)},c=u.prototype;return c._$typeName="MetadataStore",pt.bubbleEvent(c,null),u.ANONTYPE_PREFIX="_IB_",c.setProperties=function(e){st(e).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},c.addDataService=function(e,t){it(e,"dataService").isInstanceOf(Tt).check(),it(t,"shouldOverwrite").isBoolean().isOptional().check();var n=this._getDataServiceIndex(e.serviceName);if(n>=0){if(!t)throw new Error("A dataService with this name '"+e.serviceName+"' already exists in this MetadataStore");this.dataServices[n]=e}else this.dataServices.push(e)},c._getDataServiceIndex=function(e){return g(this.dataServices,function(t){return t.serviceName===e})},c.addEntityType=function(e){if(e instanceof Ot||e instanceof At||(e=e.isComplexType?new At(e):new Ot(e)),!e.isComplexType){if(e.baseTypeName&&!e.baseEntityType){var t=this._getEntityType(e.baseTypeName,!0);e._updateFromBase(t)}if(0===e.keyProperties.length&&!e.isAbstract)throw new Error("Unable to add "+e.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.")}if(e.metadataStore=this,!e.isAnonymous){if(this._structuralTypeMap[e.name])throw new Error("Type "+e.name+" already exists in this MetadataStore.");this._structuralTypeMap[e.name]=e,this._shortNameMap[e.shortName]=e.name}if(e.getProperties().forEach(function(t){e._updateNames(t),t.isUnmapped||e._mappedPropertiesCount++}),e._updateCps(),!e.isComplexType){e._updateNps();var n=e.defaultResourceName||e.baseEntityType&&e.baseEntityType.defaultResourceName;n&&!this.getEntityTypeNameForResourceName(n)&&this.setEntityTypeForResourceName(n,e.name),e.defaultResourceName=n,e.getEntityCtor()}},c.exportMetadata=function(){var e=JSON.stringify({metadataVersion:X.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:r(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,ct.stringifyPad);return e},c.importMetadata=function(e,n){it(n,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={};var r="string"==typeof e?JSON.parse(e):e;if(r.schema)return Nt.parse(this,r.schema,r.altMetadata);if(r.metadataVersion&&r.metadataVersion!==X.metadataVersion){var a=q("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",r.metadataVersion,X.metadataVersion);throw new Error(a)}var i=r.namingConvention,o=r.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=ct._fetchObject(kt,i)||this.namingConvention,this.localQueryComparisonOptions=ct._fetchObject(Mt,o)||this.localQueryComparisonOptions;else{if(i&&this.namingConvention.name!==i)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(o&&this.localQueryComparisonOptions.name!==o)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var s=this;r.dataServices&&r.dataServices.forEach(function(e){e=Tt.fromJSON(e),s.addDataService(e,!0)});this._structuralTypeMap;return r.structuralTypes&&r.structuralTypes.forEach(function(e){t(s,e,n)}),p(this._resourceEntityTypeMap,r.resourceEntityTypeMap),p(this._incompleteTypeMap,r.incompleteTypeMap),this},u.importMetadata=function(e){var t=new bt;return t.importMetadata(e),t},c.hasMetadataFor=function(e){return!!this.getDataService(e)},c.getDataService=function(e){return it(e,"serviceName").isString().check(),e=Tt._normalizeServiceName(e),v(this.dataServices,function(t){return t.serviceName===e})},c.fetchMetadata=function(e,t,n){try{if(it(e,"dataService").isString().or().isInstanceOf(Tt).check(),it(t,"callback").isFunction().isOptional().check(),it(n,"errorCallback").isFunction().isOptional().check(),"string"==typeof e&&(e=this.getDataService(e)||new Tt({serviceName:e})),e=Tt.resolve([e]),this.hasMetadataFor(e.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+e.serviceName);var r=this;return e.adapterInstance.fetchMetadata(this,e).then(function(n){return r.metadataFetched.publish({metadataStore:r,dataService:e,rawMetadata:n}),t&&t(n),Pt.resolve(n)},function(e){return n&&n(e),Pt.reject(e)})}catch(a){return Pt.reject(a)}},c.trackUnmappedType=function(e,t){it(e,"entityCtor").isFunction().check(),it(t,"interceptor").isFunction().isOptional().check();var n=new Ot(this);n._setCtor(e,t)},c.registerEntityTypeCtor=function(e,t,n,r){it(e,"structuralTypeName").isString().check(),it(t,"aCtor").isFunction().isOptional().check(),it(n,"initFn").isOptional().isFunction().or().isString().check(),it(r,"noTrackingFn").isOptional().isFunction().check();var a=o(this,e,!1),i=a||e;if(this._ctorRegistry[i]={ctor:t,initFn:n,noTrackingFn:r},a){var s=this._structuralTypeMap[a];s&&s.getCtor(!0)}},c.toQueryString=function(e){if(!e)throw new Error("query cannot be empty");if("string"==typeof e)return e;if(e instanceof It)return e._toUri(this);throw new Error("unable to recognize query parameter as either a string or an EntityQuery")},c.isEmpty=function(){return V(this._structuralTypeMap)},c.getEntityType=function(e,t){return it(e,"structuralTypeName").isString().check(),it(t,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(e,t)},c._getEntityType=function(e,t){var n=o(this,e,!1),r=this._structuralTypeMap[n];if(!r){if(t)return null;var a=q("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",e);throw new Error(a)}if(r.length){var i=r.join(",");throw new Error("There are multiple types with this 'shortName': "+i)}return r},c.getEntityTypes=function(){return e(this._structuralTypeMap)},c.getIncompleteNavigationProperties=function(){return r(this._incompleteTypeMap,function(e,t){return t})},c.getEntityTypeNameForResourceName=function(e){return it(e,"resourceName").isString().check(),this._resourceEntityTypeMap[e]
},c.setEntityTypeForResourceName=function(e,t){it(e,"resourceName").isString().check(),it(t,"entityTypeOrName").isInstanceOf(Ot).or().isString().check();var n;n=t instanceof Ot?t.name:o(this,t,!0),this._resourceEntityTypeMap[e]=n;var r=this._getEntityType(n,!0);r&&!r.defaultResourceName&&(r.defaultResourceName=e)},c._checkEntityType=function(e){if(!e.entityType){var t=e.prototype._$typeName;if(!t)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var n=this._getEntityType(t);n&&(e.entityType=n)}},u}(),Nt=function(){function e(e,n,a){e._entityTypeResourceMap={},d(n).forEach(function(n){if(n.cSpaceOSpaceMapping){var a=JSON.parse(n.cSpaceOSpaceMapping),i={};a.forEach(function(e){i[e[0]]=e[1]}),n.cSpaceOSpaceMapping=i}n.entityContainer&&d(n.entityContainer).forEach(function(t){d(t.entitySet).forEach(function(t){var r=m(t.entityType,n).typeName;e.setEntityTypeForResourceName(t.name,r),e._entityTypeResourceMap[r]=t.name})}),n.complexType&&d(n.complexType).forEach(function(t){r(t,n,e)}),n.entityType&&d(n.entityType).forEach(function(r){t(r,n,e)})});var i=e.getIncompleteNavigationProperties();if(i.length>0){var o=i.map(function(e){return e.parentType.name+":"+e.name}).join(", ");throw new Error("Incomplete navigation properties: "+o)}return a&&e.importMetadata(a,!0),e}function t(e,t,r){var a=e.name,i=g(a,t),o=new Ot({shortName:a,namespace:i,isAbstract:e.abstract&&"true"===e.abstract});if(e.baseType){var s=m(e.baseType,t).typeName;o.baseTypeName=s;var u=r._getEntityType(s,!0);if(u)n(o,e,t,r);else{var p=r._deferredTypes[s];p||(p=[],r._deferredTypes[s]=p),p.push({entityType:o,csdlEntityType:e})}}else n(o,e,t,r);return o}function n(e,t,r,i){var o=t.key?d(t.key.propertyRef).map(s("name")):[];d(t.property).forEach(function(t){a(e,t,r,o)}),d(t.navigationProperty).forEach(function(t){u(e,t,r)}),i.addEntityType(e),e.defaultResourceName=i._entityTypeResourceMap[e.name];var p=i._deferredTypes,c=p[e.name];c&&(c.forEach(function(e){n(e.entityType,e.csdlEntityType,r,i)}),delete p[e.name])}function r(e,t,n){var r=e.name,i=g(r,t),o=new At({shortName:r,namespace:i});return d(e.property).forEach(function(e){a(o,e,t)}),n.addEntityType(o),o}function a(e,t,n,r){var a,s=t.type.split(".");return"Edm"===s[0]&&2===s.length?a=i(e,t,r):p(t,n)?(a=i(e,t,r),a&&(a.enumType=t.type)):a=o(e,t,n),a&&(e._addPropertyCore(a),y(a)),a}function i(e,t,n){var r=wt.fromEdmDataType(t.type);if(null==r)return e.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type),null;var a="true"===t.nullable||null==t.nullable,i=null!=n&&n.indexOf(t.name)>=0;i&&e.autoGeneratedKeyType===xt.None&&f(t)&&(e.autoGeneratedKeyType=xt.Identity);var o=t.maxLength;o=null==o||"Max"===o?null:parseInt(o,10);var s=new Ct({nameOnServer:t.name,dataType:r,isNullable:a,isPartOfKey:i,maxLength:o,defaultValue:t.defaultValue,concurrencyMode:t.concurrencyMode});return r===wt.Undefined&&(s.rawTypeName=t.type),s}function o(e,t,n){var r=m(t.type,n).typeName,a=new Ct({nameOnServer:t.name,complexTypeName:r,isNullable:!1});return a}function u(e,t,n){var r=h(t,n),a=v(r.end,function(e){return e.role===t.toRole}),i="*"!==a.multiplicity,o=m(a.type,n).typeName,u=r.referentialConstraint;if(u||"*"!=r.end[0].multiplicity||"*"!=r.end[1].multiplicity){var p={nameOnServer:t.name,entityTypeName:o,isScalar:i,associationName:r.name};if(u){var c=u.principal,l=u.dependent,y=d(l.propertyRef),f=y.map(s("name"));t.fromRole===c.role?p.invForeignKeyNamesOnServer=f:p.foreignKeyNamesOnServer=f}var g=new Ft(p);return e._addPropertyCore(g),g}}function p(e,t){return t.enumType?c(e,t):t.extensions?l(e,t):!1}function c(e,t){var n=d(t.enumType),r=e.type.split("."),a=r[r.length-1];return n.some(function(e){return e.name===a})}function l(e,t){var n=t.extensions.filter(function(e){return"EnumType"===e.name}),r=e.type.split("."),a=r[r.length-1];return n.some(function(e){return e.attributes.some(function(e){return"Name"===e.name&&e.value===a})})}function y(e){var t;if(e.isNullable||e.validators.push(ft.required()),!e.isComplexProperty){if(e.dataType===wt.String)if(e.maxLength){var n={maxLength:e.maxLength};t=ft.maxLength(n)}else t=ft.string();else t=e.dataType.validatorCtor();e.validators.push(t)}}function f(e){var t=v(Object.keys(e),function(e){return e.indexOf("StoreGeneratedPattern")>=0});if(t)return"Identity"===e[t];var n=e.extensions;if(!n)return!1;var r=v(n,function(e){return"StoreGeneratedPattern"===e.name&&"Identity"===e.value});return!!r}function h(e,t){var n=m(e.relationship,t).shortTypeName,r=t.association;if(!r)return null;Array.isArray(r)||(r=[r]);var a=v(r,function(e){return e.name===n});return a}function m(e,t){if(!e)return null;if(j(e,bt.ANONTYPE_PREFIX))return{shortTypeName:e,namespace:"",typeName:e,isAnonymous:!0};var n=e.split(",")[0],r=n.split(".");if(r.length>1){var a=r[r.length-1],i=null;if(t&&(i=g(a,t)),!i){var o=r.slice(0,r.length-1);i=o.join(".")}return{shortTypeName:a,namespace:i,typeName:H(a,i)}}return{shortTypeName:e,namespace:"",typeName:e}}function g(e,t){var n,r=t.cSpaceOSpaceMapping;if(r){var a=r[t.namespace+"."+e];if(n=a&&a.substr(0,a.length-(e.length+1)))return n}return t.entityType||"Default"!=t.namespace?t.namespace:null}var E=A(function(e){return e&&m(e).typeName});return{parse:e,normalizeTypeName:E}}(),Ot=function(){function e(e,t){return e.entityAspect||e.complexAspect?e.getProperty(t.name):e[t.name]}function t(){return function(){}}function n(e){return e.filter(function(e){return null==e.baseProperty})}function r(e,t,n){var r=n+"OnServer",a=t[n];if(a&&a.length){var i=d(a).map(function(n){var r=e.clientPropertyNameToServer(n,t),a=e.serverPropertyNameToClient(r,t);if(n!==a)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+n+"-->"+a);return r});t[r]=Array.isArray(a)?i:i[0]}else{var o=t[r];if(!o||0===o.length)return;var s=d(o).map(function(n){var r=e.serverPropertyNameToClient(n,t),a=e.clientPropertyNameToServer(r,t);if(n!==a)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+n+"-->"+a);return r});t[n]=Array.isArray(o)?s:s[0]}}function i(e,t){var n=t._getEntityType(e.complexTypeName,!0);if(!n)return!1;if(!(n instanceof At))throw new Error("Unable to resolve ComplexType with the name: "+e.complexTypeName+" for the property: "+property.name);return e.dataType=n,e.defaultValue=null,!0}function u(e,t){if(e.entityType)return!0;var n=t._getEntityType(e.entityTypeName,!0);if(n)e.entityType=n,e._resolveNp();else{var r=_(t._incompleteTypeMap,e.entityTypeName);E(r,e)}return!!n}function p(e,t){var n=e.getPropertyNames(),r=lt.getDefaultInstance(),i=r.getTrackablePropertyNames(t);i.forEach(function(r){if(-1===n.indexOf(r)){var i=t[r];try{"function"==typeof i&&(i=i())}catch(o){}var s=wt.fromValue(i),u=new Ct({name:r,dataType:s,isNullable:!0,isUnmapped:!0});u.isSettable=a(t,r),e.subtypes?e.getSelfAndSubtypes().forEach(function(e){e._addPropertyCore(new Ct(u))}):e._addPropertyCore(u)}})}var c=0,l=function(e){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===e._$typeName?(this.metadataStore=e,this.shortName="Anon_"+ ++c,this.namespace="",this.isAnonymous=!0):st(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(xt).isOptional().withDefault(xt.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this),this.name=H(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.inverseForeignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],Z(this,e.dataProperties,Ct),Z(this,e.navigationProperties,Ft)},f=l.prototype,h=wt.parseRawValue;return f._$typeName="EntityType",l.qualifyTypeName=H,f.setProperties=function(e){st(e).whereParam("autoGeneratedKeyType").isEnumOf(xt).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this),e.defaultResourceName&&(this.defaultResourceName=e.defaultResourceName)},f.isSubtypeOf=function(e){it(e,"entityType").isInstanceOf(Ot).check();var t=this;do{if(t===e)return!0;t=t.baseEntityType}while(t);return!1},f.getSelfAndSubtypes=function(){var e=[this];return this.subtypes.forEach(function(t){var n=t.getSelfAndSubtypes();e.push.apply(e,n)}),e},f.getAllValidators=function(){for(var e=this.validators.slice(0),t=this.baseEntityType;t;)e.push.apply(e,t.validators),t=t.baseEntityType;return e},f.addProperty=function(e){return it(e,"property").isInstanceOf(Ct).or().isInstanceOf(Ft).check(),this._addPropertyCore(e,!0)},f._updateFromBase=function(e){this.baseEntityType=e,this.autoGeneratedKeyType===xt.None&&(this.autoGeneratedKeyType=e.autoGeneratedKeyType),e.dataProperties.forEach(function(e){var t=new Ct(e);t.validators=[],t.baseProperty=e,this._addPropertyCore(t)},this),e.navigationProperties.forEach(function(e){var t=new Ft(e);t.validators=[],t.baseProperty=e,this._addPropertyCore(t)},this),e.subtypes.push(this)},f._addPropertyCore=function(e,t){if(this.isFrozen)throw new Error("The '"+this.name+"' EntityType/ComplexType has been frozen. You can only add properties to an EntityType/ComplexType before any instances of that type have been created and attached to an entityManager.");var n=e.parentType;if(n){if(n!==this)throw new Error("This property: "+e.name+" has already been added to "+e.parentType.name);return this}e.parentType=this;var a=this.metadataStore;return e.isDataProperty?this._addDataProperty(e):(this._addNavigationProperty(e),t&&a&&u(e,a)),!a||e.name&&e.nameOnServer||r(a.namingConvention,e,"name"),this},f.createEntity=function(t){if(t&&t._$eref&&!t._$eref.entityAspect.entityManager)return t._$eref;var n=this._createInstanceCore();return t&&(this.keyProperties.every(function(e){return null!=t[e.name]})&&(t._$eref=n),this._updateTargetFromRaw(n,t,e),this.navigationProperties.forEach(function(e){var r,a=t[e.name];if(void 0!=a){var i=e.entityType;if(e.isScalar)r=a.entityAspect?a:i.createEntity(a),n.setProperty(e.name,r);else{var o=n.getProperty(e.name);a.forEach(function(e){r=e.entityAspect?e:i.createEntity(e),o.push(r)})}}})),this._initializeInstance(n),n},f._createInstanceCore=function(){var e=this.getEntityCtor(),t=new e;return new vt(t),t},f._initializeInstance=function(e){this.baseEntityType&&this.baseEntityType._initializeInstance(e);var t=this.initFn;t&&("string"==typeof t&&(t=e[t]),t(e)),this.complexProperties&&this.complexProperties.forEach(function(t){var n=e.getProperty(t.name);Array.isArray(n)?n.forEach(function(e){t.dataType._initializeInstance(e)}):t.dataType._initializeInstance(n)}),e.entityAspect&&(e.entityAspect._initialized=!0)},f.getCtor=f.getEntityCtor=function(e){if(this._ctor&&!e)return this._ctor;var n=this.metadataStore._ctorRegistry,r=n[this.name]||n[this.shortName]||{},a=r.ctor||this._ctor,i=a&&a.prototype&&(a.prototype.entityType||a.prototype.complexType);if(i&&i.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");if(r.ctor&&e&&(this._extra=void 0),!a){var o=lt.getDefaultInstance().createCtor;a=o?o(this):t()}return this.initFn=r.initFn,this.noTrackingFn=r.noTrackingFn,a.prototype._$typeName=this.name,this._setCtor(a),a},f._setCtor=function(e,t){var n=e.prototype;this._extra=this._extra||{};var r=new e;p(this,r),"EntityType"===this._$typeName?n.entityType=this:n.complexType=this,n._$interceptor=t||z,lt.getDefaultInstance().initializeEntityPrototype(n),this._ctor=e},f.addValidator=function(e,t){it(e,"validator").isInstanceOf(ft).check(),it(t,"property").isOptional().isString().or().isEntityProperty().check(),t?("string"==typeof t&&(t=this.getProperty(t,!0)),t.validators.push(e)):this.validators.push(e)},f.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},f.getPropertyNames=function(){return this.getProperties().map(s("name"))},f.getDataProperty=function(e,t){var n=t?"nameOnServer":"name";return v(this.dataProperties,o(n,e))},f.getNavigationProperty=function(e,t){var n=t?"nameOnServer":"name";return v(this.navigationProperties,o(n,e))},f.getProperty=function(e,t){t=t||!1;var n=Array.isArray(e)?e:e.trim().split("."),r=n[0],a=v(this.getProperties(),o("name",r));if(1===n.length){if(a)return a;if(t)throw new Error("unable to locate property: "+r+" on entityType: "+this.name);return null}if(a){n.shift();var i=a.isNavigationProperty?a.entityType:a.dataType;if(i)return i.getProperty(n,t);throw new Error("should not get here - unknown property type for: "+a.name)}if(t)throw new Error("unable to locate property: "+r+" on type: "+this.name);return null},f.getEntityKeyFromRawEntity=function(e,t){var n=this.keyProperties.map(function(n){var r=t(e,n);return h(r,n.dataType)});return new Et(this,n)},f._updateTargetFromRaw=function(e,t,n){this.dataProperties.forEach(function(r){if(r.isSettable){var a=n(t,r);if(void 0!==a){var i,o=r.dataType;if(r.isComplexProperty){if(null===a)return;i=e.getProperty(r.name),r.isScalar?o._updateTargetFromRaw(i,a,n):(i.length=0,Array.isArray(a)&&a.forEach(function(t){var a=o._createInstanceCore(e,r);o._updateTargetFromRaw(a,t,n),o._initializeInstance(a),i.push(a)}))}else{var s;r.isScalar?(s=h(a,o),e.setProperty(r.name,s)):(i=e.getProperty(r.name),i.length=0,Array.isArray(a)&&a.forEach(function(e){s=h(e,o),i.push(s)}))}}}});var r=t.entityAspect||t.complexAspect;if(r){var a=e.entityAspect||e.complexAspect;r.originalValuesMap&&(a.originalValues=r.originalValuesMap),r.extraMetadata&&(a.extraMetadata=r.extraMetadata)}},f.toString=function(){return this.name},f.toJSON=function(){return y(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:n,navigationProperties:n,validators:null,custom:null})},f._clientPropertyPathToServer=function(e){var t=this.metadataStore.namingConvention.clientPropertyNameToServer,n=this,r=e.split(".").map(function(e){var r=n.getProperty(e);return t(e,r)}).join("/");return r},f._updateNames=function(e){var t=this.metadataStore.namingConvention;r(t,e,"name"),e.isNavigationProperty&&(r(t,e,"foreignKeyNames"),r(t,e,"invForeignKeyNames"))},f._checkNavProperty=function(e){if(e.isNavigationProperty){if(e.parentType!==this)throw new Error(q("The navigationProperty '%1' is not a property of entity type '%2'",e.name,this.name));return e}if("string"==typeof e){var t=this.getProperty(e);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},f._addDataProperty=function(e){this.dataProperties.push(e),e.isPartOfKey&&this.keyProperties.push(e),e.isComplexProperty&&this.complexProperties.push(e),e.concurrencyMode&&"None"!==e.concurrencyMode&&this.concurrencyProperties.push(e),e.isUnmapped&&this.unmappedProperties.push(e)},f._addNavigationProperty=function(e){this.navigationProperties.push(e),J(e.entityTypeName)||(e.entityTypeName=H(e.entityTypeName,this.namespace))},f._updateCps=function(){var e=this.metadataStore,t=e._incompleteComplexTypeMap;this.complexProperties.forEach(function(n){n.complexType||i(n,e)||_(t,n.complexTypeName).push(n)}),this.isComplexType&&((t[this.name]||[]).forEach(function(t){i(t,e)}),delete t[this.name])},f._updateNps=function(){var e=this.metadataStore;this.navigationProperties.forEach(function(t){u(t,e)});var t=e._incompleteTypeMap;(t[this.name]||[]).forEach(function(t){u(t,e)}),delete t[this.name]},l}(),At=function(){var e=function(e){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");st(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().applyAll(this),this.name=H(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],Z(this,e.dataProperties,Ct)},t=e.prototype;return t.setProperties=function(e){st(e).whereParam("custom").isOptional().applyAll(this)},t.getAllValidators=function(){return this.validators},t._createInstanceCore=function(e,t){var n=this.getCtor(),r=new n;return new gt(r,e,t),r},t.addProperty=function(e){return it(e,"dataProperty").isInstanceOf(Ct).check(),this._addPropertyCore(e)},t.getProperties=function(){return this.dataProperties},t=p(t,Ot.prototype,["addValidator","getProperty","getPropertyNames","_addPropertyCore","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_clientPropertyPathToServer","_setCtor"]),t.createInstance=Ot.prototype.createEntity,t.getCtor=Ot.prototype.getEntityCtor,t.toJSON=function(){return y(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},t._$typeName="ComplexType",e}(),Ct=function(){var e=function(e){st(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(wt).isOptional().or().isString().or().isInstanceOf(At).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("isSettable").isBoolean().isOptional().withDefault(!0).whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(ft).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var n=wt.fromName(this.dataType);if(!n)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=n}else this.dataType||(this.dataType=wt.String);if(null==this.defaultValue){if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===wt.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+(this.name||this.nameOnServer))}else this.dataType.isNumeric&&"string"==typeof this.defaultValue&&(this.defaultValue=parseFloat(this.defaultValue));this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},t=e.prototype;return t._$typeName="DataProperty",e.getRawValueFromServer=function(e,t){if(t.isUnmapped)return e[t.nameOnServer||t.name];var n=e[t.nameOnServer];return void 0!==n?n:t.defaultValue},e.getRawValueFromClient=function(e,t){var n=e[t.name];return void 0!==n?n:t.defaultValue},t.isDataProperty=!0,t.isNavigationProperty=!1,t.resolveProperty=function(e){for(var t=this[e],n=this.baseProperty;void 0==t&&null!=n;)t=n[e],n=n.baseProperty;return t},t.formatName=function(){return this.parentType.name+"--"+this.name},t.setProperties=function(e){st(e).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this)},t.getAllValidators=function(){for(var e=this.validators.slice(0),t=this.baseProperty;t;)e.push.apply(e,t.validators),t=t.baseProperty;return e},t.toJSON=function(){return y(this,{name:null,dataType:function(e){return e&&e.parentEnum?e.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,isSettable:!0,concurrencyMode:null,maxLength:null,validators:null,displayName:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},e.fromJSON=function(e){return e.dataType=wt.fromName(e.dataType),e.defaultValue&&e.dataType&&e.dataType.isDate&&(e.defaultValue=new Date(Date.parse(e.defaultValue))),e.validators&&(e.validators=e.validators.map(ft.fromJSON)),new Ct(e)},e}(),Ft=function(){function e(e,t){throw new Error("Cannot set the inverse property for: "+e.formatName()+". "+t)}function t(e,t){throw new Error("Cannot create inverse for: "+e.formatName()+". The entityType for this navigation property "+t)}function n(e){var t=e.foreignKeyNames;if(0!==t.length){var n=e.parentType,r=t.map(function(e){return n.getDataProperty(e)}),a=n.foreignKeyProperties;r.forEach(function(t){E(a,t),t.relatedNavigationProperty=e,E(e.entityType.inverseForeignKeyProperties,t),e.relatedDataProperties?E(e.relatedDataProperties,t):e.relatedDataProperties=[t]})}}var r=function(e){st(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(ft).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},a=r.prototype;return a._$typeName="NavigationProperty",a.isDataProperty=!1,a.isNavigationProperty=!0,p(a,Ct.prototype,["formatName","getAllValidators","resolveProperty"]),a.setProperties=function(e){if(!this.parentType)throw new Error("Cannot call NavigationProperty.setProperties until the parent EntityType of the NavigationProperty has been set.");var t=e.inverse;t&&delete e.inverse,st(e).whereParam("displayName").isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this),this.parentType._updateNames(this),this._resolveNp(),t&&this.setInverse(t)},a.setInverse=function(t){var n;if(n="string"==typeof t?this.entityType.getNavigationProperty(t):t,!n)throw e(this,"Unable to find inverse property: "+invNpName);(this.inverse||n.inverse)&&e(this,"It has already been set on one side or the other."),n.entityType!=this.parentType&&e(this,n.formatName+" is not a valid inverse property for this."),this.associationName?n.associationName=this.associationName:(n.associationName||(n.associationName=this.formatName()+"_"+n.formatName()),this.associationName=n.associationName),this._resolveNp(),n._resolveNp()},a.createInverse=function(e){this.entityType||t(this,"has not yet been defined."),this.entityType.isFrozen&&t(this,"is frozen.");var n=this.entityType.metadataStore;null==n&&t(this,"has not yet been added to the metadataStore."),e.entityTypeName=this.parentEntityType.name,e.associationName=this.associationName;var r=new Ft(e);return this.parentEntityType.addNavigationProperty(r),r},a.toJSON=function(){return y(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,displayName:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},r.fromJSON=function(e){return e.validators&&(e.validators=e.validators.map(ft.fromJSON)),new Ft(e)},a._resolveNp=function(){var e=this,t=e.entityType,r=v(t.navigationProperties,function(t){return t.associationName===e.associationName&&(t.name!==e.name||t.entityTypeName!==e.entityTypeName)});e.inverse=r,r||e.invForeignKeyNames.forEach(function(n){var r=t.getDataProperty(n);if(!r)throw new Error("EntityType '"+e.entityTypeName+"' has no foreign key matching '"+n+"'");var a=e.parentType;r.inverseNavigationProperty=v(a.navigationProperties,function(e){return e.invForeignKeyNames&&e.invForeignKeyNames.indexOf(r.name)>=0&&e.entityType===r.parentType}),E(t.foreignKeyProperties,r)}),n(e)},r}(),xt=function(){var e=new ut("AutoGeneratedKeyType");return e.None=e.addSymbol(),e.Identity=e.addSymbol(),e.KeyGenerator=e.addSymbol(),e.resolveSymbols(),e}();!function(){function e(e,t){return null==t?!1:void 0!==t.entityType}function t(e,t){return null==t?!1:t.isDataProperty||t.isNavigationProperty}var n=at.prototype;n.isEntity=function(){return this._addContext({fn:e,msg:" must be an entity"})},n.isEntityProperty=function(){return this._addContext({fn:t,msg:" must be either a DataProperty or a NavigationProperty"})}}(),X.MetadataStore=bt,X.EntityType=Ot,X.ComplexType=At,X.DataProperty=Ct,X.NavigationProperty=Ft,X.AutoGeneratedKeyType=xt,bt.normalizeTypeName=Nt.normalizeTypeName;var Dt=function(){function e(e,t,n){var r=t.name+".."+t.parentType.name,a=e._tempIdMap[r];return a||n&&(a={entityType:t.parentType,propertyName:t.name,keyMap:{}},e._tempIdMap[r]=a),a}var t=function(){this._tempIdMap={}},n=t.prototype;return n.generateTempKeyValue=function(t,n){var r=t.keyProperties;if(r.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");var a,i=r[0],o=e(this,i,!0);if(null!=n&&(o.keyMap[n.toString()]||(a=n)),void 0===a){var s=i.dataType;if(!s.getNext)throw new Error("Cannot use a property with a dataType of: "+s.toString()+" for id generation");for(a=s.getNext(this);null!=o.keyMap[a.toString()];)a=s.getNext(this)}return o.keyMap[a.toString()]=!0,a},n.getTempKeys=function(){var e=[];for(var t in this._tempIdMap){var n=this._tempIdMap[t],r=n.entityType;for(var a in n.keyMap)e.push(new Et(r,[a]))}return e},n.isTempKey=function(t){var n=t.entityType.keyProperties;if(n.length>1)return!1;var r=n[0],a=e(this,r);return a?void 0!==a.keyMap[t.values[0].toString()]:!1},ct.registerType(t,"KeyGenerator"),t}();X.KeyGenerator=Dt;var Mt=function(){var e=function(e){st(e||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=C()),ct._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="LocalQueryComparisonOptions",e.caseInsensitiveSQL=new e({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),e.defaultInstance=new e(e.caseInsensitiveSQL),t.setAsDefault=function(){return l(this,e)},e}();X.LocalQueryComparisonOptions=Mt;var kt=function(){var e=function(e){st(e||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=C()),ct._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="NamingConvention",e.none=new e({name:"noChange",serverPropertyNameToClient:function(e){return e},clientPropertyNameToServer:function(e){return e}}),e.camelCase=new e({name:"camelCase",serverPropertyNameToClient:function(e){return e.substr(0,1).toLowerCase()+e.substr(1)},clientPropertyNameToServer:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}}),e.defaultInstance=new e(e.none),t.setAsDefault=function(){return l(this,e)},e}();X.NamingConvention=kt;var It=function(){function e(n,r,a,i){var o=a._$typeName||a.parentEnum&&a.parentEnum.name,s=o&&o.substr(0,1).toLowerCase()+o.substr(1);if(i&&s!=i)throw new Error("Invalid value for property: "+i);if(s){var u=r[s];if(void 0===u)throw new Error("Invalid config property: "+s);null===u?n[s]=a:u(n,a)}else t(a,function(t,a){e(n,r,a,t)})}function n(e,t,n){if(t&&e[t]===n)return e;var r=p(new It,e,["resourceName","fromEntityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","queryOptions","entityManager","dataService","resultEntityType"]);return r.parameters=p({},e.parameters),t&&(r[t]=n),r}function r(e){return it(e,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof e&&(e=e.split(",")),e=e.map(function(e){return e.trim()})}function a(e){var t=e.entityType,n=t.keyProperties.map(function(t){return qt.create(t.name,jt.Equals,e.getProperty(t.name))}),r=qt.and(n);return r}function i(e,t,a){var i;return null==t?i=null:(t=r(t),i=Bt.create(t,a),e.orderByClause&&(i=e.orderByClause.addClause(i))),n(e,"orderByClause",i)}function o(e){var t=e.entityType.keyProperties,n=w(t,e.values,function(e,t){return qt.create(e.name,jt.Equals,t)}),r=qt.and(n);return r}function s(e,t){if(t.isScalar){if(0===t.foreignKeyNames.length)return null;var n=t.foreignKeyNames.map(function(t){return e.getProperty(t)}),r=new Et(t.entityType,n);return o(r)}var a=t.inverse,i=a?a.foreignKeyNames:t.invForeignKeyNames;if(0===i.length)return null;var s=e.entityAspect.getKey().values,u=w(i,s,function(e,t){return qt.create(e,jt.Equals,t)});return qt.and(u)}var u=function(e){it(e,"resourceName").isOptional().isString().check(),this.resourceName=e,this.fromEntityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.noTrackingEnabled=!1,this.entityManager=null},c=u.prototype;return c._$typeName="EntityQuery",c.from=function(e){return it(e,"resourceName").isString().check(),n(this,"resourceName",e)},u.from=function(e){return it(e,"resourceName").isString().check(),new It(e)},c.toType=function(e){return it(e,"entityType").isString().or().isInstanceOf(Ot).check(),n(this,"resultEntityType",e)},c.where=function(e){return null!=e&&(e instanceof qt||(e=qt.create(tt(arguments))),this.fromEntityType&&e.validate(this.fromEntityType),this.wherePredicate&&(e=new zt("and",[this.wherePredicate,e]))),n(this,"wherePredicate",e)},c.orderBy=function(e){return i(this,e)},c.orderByDesc=function(e){return i(this,e,!0)},c.select=function(e){var t=null==e?null:new Gt(r(e));return n(this,"selectClause",t)},c.skip=function(e){return it(e,"count").isOptional().isNumber().check(),n(this,"skipCount",null==e?null:e)},c.top=function(e){return this.take(e)},c.take=function(e){return it(e,"count").isOptional().isNumber().check(),n(this,"takeCount",null==e?null:e)},c.expand=function(e){var t=null==e?null:new Qt(r(e));return n(this,"expandClause",t)},c.withParameters=function(e){return it(e,"parameters").isObject().check(),n(this,"parameters",e)},c.inlineCount=function(e){return it(e,"enabled").isBoolean().isOptional().check(),e=void 0===e?!0:!!e,n(this,"inlineCountEnabled",e)},c.noTracking=function(e){return it(e,"enabled").isBoolean().isOptional().check(),e=void 0===e?!0:!!e,n(this,"noTrackingEnabled",e)},c.using=function(t){if(!t)return this;var r=n(this);return e(r,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Zt).using(t)},mergeStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Zt).using(t)},jsonResultsAdapter:function(e,t){e.dataService=(e.dataService||new Tt).using({jsonResultsAdapter:t})
}},t),r},c.execute=function(e,t){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,e,t)},c.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},u.fromEntities=function(e){it(e,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(e)||(e=tt(arguments));var t=e[0],n=new It(t.entityType.defaultResourceName),r=e.map(function(e){return a(e)}),i=qt.or(r);n=n.where(i);var o=t.entityAspect.entityManager;return o&&(n=n.using(o)),n},u.fromEntityKey=function(e){it(e,"entityKey").isInstanceOf(Et).check();var t=new It(e.entityType.defaultResourceName),n=o(e);return t=t.where(n).toType(e.entityType)},u.fromEntityNavigation=function(e,t){it(e,"entity").isEntity().check();var n=e.entityType._checkNavProperty(t),r=new It(n.entityType.defaultResourceName),a=s(e,n);r=r.where(a);var i=e.entityAspect.entityManager;return i&&(r=r.using(i)),r},c._getFromEntityType=function(e,t){var n=this.fromEntityType;if(n)return n;var r=this.resourceName;if(!r)throw new Error("There is no resourceName for this query");if(e.isEmpty()){if(t)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");return null}var a=e.getEntityTypeNameForResourceName(r);if(n=a?e._getEntityType(a):this._getToEntityType(e,!0),!n){if(t)throw new Error(q("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",r));return null}return this.fromEntityType=n,n},c._getToEntityType=function(e,t){return this.resultEntityType instanceof Ot?this.resultEntityType:this.resultEntityType?(this.resultEntityType=e._getEntityType(this.resultEntityType,!1),this.resultEntityType):t?null:!this.selectClause&&this._getFromEntityType(e,!1)},c._toUri=function(e){function t(){return qt._next=0,p(l.wherePredicate)}function n(){return l.inlineCountEnabled?l.inlineCountEnabled?"allpages":"none":void 0}function r(){return p(l.orderByClause)}function a(){return p(l.selectClause)}function i(){var e=l.expandClause;if(e)return e.toODataFragment(c)}function o(){var e=l.skipCount;if(e)return e.toString()}function s(){var e=l.takeCount;if(null!=e)return e.toString()}function u(e){var t=[];for(var n in e){var r=e[n];void 0!==r&&(r instanceof Array?r.forEach(function(e){t.push(n+"="+encodeURIComponent(e))}):t.push(n+"="+encodeURIComponent(r)))}return t.length>0?"?"+t.join("&"):""}function p(e){return e?(c.isAnonymous||e.validate(c),e.toODataFragment(c)):void 0}var c=this._getFromEntityType(e,!1);c||(c=new Ot(e));var l=this,y={};y.$filter=t(),y.$orderby=r(),y.$skip=o(),y.$top=s(),y.$expand=i(),y.$select=a(),y.$inlinecount=n();var f=u(y);return this.resourceName+f},c._toFilterFunction=function(e){var t=this.wherePredicate;return t?(t.validate(e),t.toFunction(e)):null},c._toOrderByComparer=function(e){var t=this.orderByClause;return t?t.getComparer(e):null},u}(),Vt=function(){var e={toupper:{fn:function(e){return e.toUpperCase()},dataType:wt.String},tolower:{fn:function(e){return e.toLowerCase()},dataType:wt.String},substring:{fn:function(e,t,n){return e.substring(t,n)},dataType:wt.String},substringof:{fn:function(e,t){return t.indexOf(e)>=0},dataType:wt.Boolean},length:{fn:function(e){return e.length},dataType:wt.Int32},trim:{fn:function(e){return e.trim()},dataType:wt.String},concat:{fn:function(e,t){return e.concat(t)},dataType:wt.String},replace:{fn:function(e,t,n){return e.replace(t,n)},dataType:wt.String},startswith:{fn:function(e,t){return j(e,t)},dataType:wt.Boolean},endswith:{fn:function(e,t){return K(e,t)},dataType:wt.Boolean},indexof:{fn:function(e,t){return e.indexOf(t)},dataType:wt.Int32},round:{fn:function(e){return Math.round(e)},dataType:wt.Int32},ceiling:{fn:function(e){return Math.ceil(e)},dataType:wt.Int32},floor:{fn:function(e){return Math.floor(e)},dataType:wt.Int32},second:{fn:function(e){return e.getSeconds()},dataType:wt.Int32},minute:{fn:function(e){return e.getMinutes()},dataType:wt.Int32},day:{fn:function(e){return e.getDate()},dataType:wt.Int32},month:{fn:function(e){return e.getMonth()+1},dataType:wt.Int32},year:{fn:function(e){return e.getFullYear()},dataType:wt.Int32}};return e}(),Rt=function(){function e(e){var t=e.split(".");return 1===t.length?function(t){return t.getProperty(e)}:function(e){return W(e,t)}}var t=/^[a-z_][\w.$]*$/i,n=/('[^']*'|[^,]+)/g,r=/("[^"]*"|[^,]+)/g,a=function(a,i,o){var s=a.split(":");if(this.isRealNode=!0,1===s.length){var u=s[0].trim();this.value=u;var p=u.substr(0,1),c=("'"===p||'"'===p)&&u.length>1&&u.substr(u.length-1)===p;if(c){var l=u.substr(1,u.length-2);this.fn=function(){return l},this.dataType=wt.String}else{var y=t.test(u);if(y){if(o&&null==o.getProperty(u,!1))return void(this.isRealNode=!1);this.propertyPath=u,this.fn=e(u)}else{if(o)return void(this.isRealNode=!1);this.fn=function(){return u},this.dataType=wt.fromValue(u)}}}else try{this.fnName=s[0].trim().toLowerCase();var f=Vt[this.fnName];this.localFn=f.fn,this.dataType=f.dataType;var h=this;this.fn=function(e){var t=h.fnNodes.map(function(t){var n=t.fn(e);return n}),n=h.localFn.apply(null,t);return n};var d=i[s[1]].trim();"("===d.substr(0,1)&&(d=d.substr(1,d.length-2));var m=a.indexOf("'")>=0?n:r,v=d.match(m);this.fnNodes=v.map(function(e){return new Rt(e,i)})}catch(g){this.isRealNode=!1}},i=a.prototype;return a.create=function(e,t,n){if("string"!=typeof e)return null;for(var r,a=/\([^()]*\)/,i=[],o=0;r=a.exec(e);){var s=r[0];i.push(s);var u=":"+o++;e=e.replace(s,u)}var p=new Rt(e,i,n?null:t);return p.isRealNode?(!p.dataType&&n&&n.isStringFn&&(p.dataType=wt.String),p._validate(t),p):null},i.toString=function(){if(this.fnName){var e=this.fnNodes.map(function(e){return e.toString()}),t=this.fnName+"("+e.join(",")+")";return t}return this.value},i.toODataFragment=function(e){if(this._validate(e),this.fnName){var t=this.fnNodes.map(function(t){return t.toODataFragment(e)}),n=this.fnName+"("+t.join(",")+")";return n}var r=this.value.substr(0,1);return"'"===r||'"'===r?this.value:this.value==this.propertyPath?e._clientPropertyPathToServer(this.propertyPath):this.value},i._validate=function(e){if(!this.isValidated){if(this.propertyPath){if(e.isAnonymous)return;var t=e.getProperty(this.propertyPath,!0);if(!t){var n=q("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",e.name,this.propertyPath);throw new Error(n)}this.dataType=t.isDataProperty?t.dataType:t.entityType}else this.fnNodes&&this.fnNodes.forEach(function(t){t._validate(e)});this.isValidated=!0}},a}(),jt=function(){var e=new ut("FilterQueryOp");return e.Equals=e.addSymbol({operator:"eq",aliases:["=="]}),e.NotEquals=e.addSymbol({operator:"ne",aliases:["!="]}),e.GreaterThan=e.addSymbol({operator:"gt",aliases:[">"]}),e.LessThan=e.addSymbol({operator:"lt",aliases:["<"]}),e.GreaterThanOrEqual=e.addSymbol({operator:"ge",aliases:[">="]}),e.LessThanOrEqual=e.addSymbol({operator:"le",aliases:["<="]}),e.Contains=e.addSymbol({operator:"substringof",aliases:["contains"],isFunction:!0,isStringFn:!0}),e.StartsWith=e.addSymbol({operator:"startswith",isFunction:!0,isStringFn:!0}),e.EndsWith=e.addSymbol({operator:"endswith",isFunction:!0,isStringFn:!0}),e.Any=e.addSymbol({operator:"any",isAnyAll:!0,aliases:["some"]}),e.All=e.addSymbol({operator:"all",isAnyAll:!0,aliases:["every"]}),e.IsTypeOf=e.addSymbol({operator:"isof",isFunction:!0,aliases:["isTypeOf"]}),e.resolveSymbols(),e._map=function(){var t={};return e.getSymbols().forEach(function(e){t[e.name.toLowerCase()]=e,t[e.operator.toLowerCase()]=e,e.aliases&&e.aliases.forEach(function(n){t[n.toLowerCase()]=e})}),t}(),e.from=function(t){return e.contains(t)?t:e._map[t.toLowerCase()]},e}(),Kt=function(){var e=new ut("BooleanQueryOp");return e.And=e.addSymbol({operator:"and",aliases:["&&"]}),e.Or=e.addSymbol({operator:"or",aliases:["||"]}),e.Not=e.addSymbol({operator:"not",aliases:["~","!"]}),e.resolveSymbols(),e._map=function(){var t={};return e.getSymbols().forEach(function(e){t[e.name.toLowerCase()]=e,t[e.operator.toLowerCase()]=e,e.aliases&&e.aliases.forEach(function(n){t[n.toLowerCase()]=e})}),t}(),e.from=function(t){return e.contains(t)?t:e._map[t.toLowerCase()]},e}(),qt=function(){function e(e){var t;if(1===e.length&&Array.isArray(e[0]))t=e[0];else{var t=tt(e);t[0]instanceof qt||(t=[qt.create(t)])}return t.filter(function(e){return null!=e})}var t=function(){return arguments[0].prototype===!0?this:new Lt(tt(arguments))},n=t.prototype;return t.create=function(e){var t=Array.isArray(e)&&1===arguments.length?e:tt(arguments);return new Lt(t)},t.and=function(t){return t=e(arguments),0===t.length?null:1===t.length?t[0]:new zt("and",t)},t.or=function(t){return t=e(arguments),0===t.length?null:1===t.length?t[0]:new zt("or",t)},t.not=function(e){return new zt("not",[e])},n.and=function(n){return n=e(arguments),n.unshift(this),t.and(n)},n.or=function(n){return n=e(arguments),n.unshift(this),t.or(n)},n.not=function(){return new zt("not",[this])},t}(),Lt=function(){function e(e,i,o){var s,u=e.metadataStore.localQueryComparisonOptions,p=Y(o);switch(i){case jt.Equals:s=function(e,n){return e&&"string"==typeof e?t(e,n,u):p(e)==p(n)};break;case jt.NotEquals:s=function(e,n){return e&&"string"==typeof e?!t(e,n,u):p(e)!=p(n)};break;case jt.GreaterThan:s=function(e,t){return p(e)>p(t)};break;case jt.GreaterThanOrEqual:s=function(e,t){return p(e)>=p(t)};break;case jt.LessThan:s=function(e,t){return p(e)<p(t)};break;case jt.LessThanOrEqual:s=function(e,t){return p(e)<=p(t)};break;case jt.StartsWith:s=function(e,t){return n(e,t,u)};break;case jt.EndsWith:s=function(e,t){return r(e,t,u)};break;case jt.Contains:s=function(e,t){return a(e,t,u)};break;case jt.Any:s=function(e,t){return e.some(function(e){return t(e)})};break;case jt.All:s=function(e,t){return e.every(function(e){return t(e)})};break;default:throw new Error("Unknown FilterQueryOp: "+i)}return s}function t(e,t,n){return null==t?!1:("string"!=typeof t&&(t=t.toString()),n.usesSql92CompliantStringComparison&&(e=(e||"").trim(),t=(t||"").trim()),n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e===t)}function n(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),j(e,t)}function r(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),K(e,t)}function a(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e.indexOf(t)>=0}var i=function(e){if(1===e.length)return void(this._odataExpr=e[0]);var t=e[0];it(t,"propertyOrExpr").isString().isOptional().check();var n=e[1];it(n,"operator").isEnumOf(jt).or().isString().check();var r=jt.from(n);if(!r)throw new Error("Unknown query operation: "+n);if(this._filterQueryOp=r,t)this._propertyOrExpr=t;else if(r!==jt.IsTypeOf)throw new Error("propertyOrExpr cannot be null except when using the 'IsTypeOf' operator");var a=e[2];return r&&r.isAnyAll?(this._value=a instanceof qt?a:new Lt(e.slice(2)),void(this._isLiteral=void 0)):(it(a,"value").isRequired(!0).check(),void(null!=a&&"object"==typeof a&&void 0!==a.value?(this._dataType=a.dataType||wt.fromValue(a.value),this._value=a.value,this._isLiteral=a.isLiteral):(this._dataType=wt.fromValue(a),this._value=a,this._isLiteral=void 0)))},o=new qt({prototype:!0});return i.prototype=o,o.toODataFragment=function(e,t){if(this._odataExpr)return this._odataExpr;var n=this._filterQueryOp,r=this._value;if(n==jt.IsTypeOf){var a=e.metadataStore.getEntityType(r),i=a.namespace+"."+a.shortName;return n.operator+"("+wt.String.fmtOData(i)+")"}this.validate(e);var o=this._fnNode1&&this._fnNode1.toODataFragment(e);if(t&&(o=t+"/"+o),qt._next+=1,t="x"+qt._next,n.isAnyAll)return o+"/"+n.operator+"("+t+": "+r.toODataFragment(this.dataType,t)+")";var s;if(this._fnNode2)s=this._fnNode2.toODataFragment(e);else{var u=this._fnNode1.dataType||this._dataType;s=u.fmtOData(r)}return n.isFunction?n==jt.Contains?n.operator+"("+s+","+o+") eq true":n.operator+"("+o+","+s+") eq true":o+" "+n.operator+" "+s},o.toFunction=function(t){if(this._odataExpr)throw new Error("OData predicateexpressions cannot be interpreted locally");this.validate(t);var n=this._fnNode1.dataType||this._dataType,r=e(t,this._filterQueryOp,n),a=this._fnNode1.fn;if(this._fnNode2){var i=this._fnNode2.fn;return function(e){return r(a(e),i(e))}}if(this._filterQueryOp&&this._filterQueryOp.isAnyAll){var o=this._value.toFunction(n);return function(e){return r(a(e),o)}}var s=this._value;return function(e){return r(a(e),s)}},o.toString=function(){return q("{%1} %2 {%3}",this._propertyOrExpr,this._filterQueryOp.operator,this._value)},o.validate=function(e){var t=this._filterQueryOp;return void 0===this._fnNode1&&this._propertyOrExpr&&(this._fnNode1=Rt.create(this._propertyOrExpr,e,t),this.dataType=this._fnNode1.dataType),t&&t.isAnyAll?void this._value.validate(this.dataType):void(void 0!==this._fnNode2||this._isLiteral||(this._fnNode2=Rt.create(this._value,e)))},i}(),zt=function(){function e(e,t,n){var r,a;switch(t){case Kt.Not:return r=n[0].toFunction(e),function(e){return!r(e)};case Kt.And:return a=n.map(function(t){return t.toFunction(e)}),function(e){var t=a.reduce(function(t,n){return t&&n(e)},!0);return t};case Kt.Or:return a=n.map(function(t){return t.toFunction(e)}),function(e){var t=a.reduce(function(t,n){return t||n(e)},!1);return t};default:throw new Error("Invalid boolean operator:"+t)}}var t=function(e,t){if(!Array.isArray(t))throw new Error("predicates parameter must be an array");if(this._booleanQueryOp=Kt.from(e),!this._booleanQueryOp)throw new Error("Unknown query operation: "+e);if(this._booleanQueryOp===Kt.Not&&1!==t.length)throw new Error("Only a single predicate can be passed in with the 'Not' operator");this._predicates=t},n=new qt({prototype:!0});return t.prototype=n,n.toODataFragment=function(e,t){if(1==this._predicates.length)return this._booleanQueryOp.operator+" ("+this._predicates[0].toODataFragment(e,t)+")";var n=this._predicates.map(function(n){return"("+n.toODataFragment(e,t)+")"}).join(" "+this._booleanQueryOp.operator+" ");return n},n.toFunction=function(t){return e(t,this._booleanQueryOp,this._predicates)},n.toString=function(){if(1==this._predicates.length)return this._booleanQueryOp.operator+" ("+this._predicates[0]+")";var e=this._predicates.map(function(e){return"("+e.toString()+")"}).join(" "+this._booleanQueryOp.operator+" ");return e},n.validate=function(e){this._isValidated||(this._predicates.every(function(t){t.validate(e)}),this._isValidated=!0)},t}(),Bt=function(){var e=function(t,n){return t.prototype===!0?this:e.create(t,n)},t=e.prototype;return e.create=function(e,t){if(e.length>1){var n=e.map(function(e){return new Ut(e,t)});return new $t(n)}return new Ut(e[0],t)},e.combine=function(e){return new $t(e)},e.isOrderByClause=function(e){return e instanceof Bt},t.addClause=function(e){return new $t([this,e])},e}(),Ut=function(){var e=function(e,t){if("string"!=typeof e)throw new Error("propertyPath is not a string");e=e.trim();var n=e.split(" ");if(n.length>1&&t!==!0&&t!==!1&&(t=j(n[1].toLowerCase(),"desc"),!t)){var r=j(n[1].toLowerCase(),"asc");if(!r)throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=n[0],this.isDesc=t},t=new Bt({prototype:!0});return e.prototype=t,t.validate=function(e){e&&(this.lastProperty=e.getProperty(this.propertyPath,!0))},t.toODataFragment=function(e){return e._clientPropertyPathToServer(this.propertyPath)+(this.isDesc?" desc":"")},t.getComparer=function(e){if(this.lastProperty||this.validate(e),this.lastProperty)var t=this.lastProperty.dataType,n=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;var r=this.propertyPath,a=this.isDesc;return function(e,i){var o=W(e,r),s=W(i,r),u=t||o&&wt.fromValue(o)||wt.fromValue(s);if(u===wt.String)n?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase());else{var p=Y(u);o=p(o),s=p(s)}return o===s?0:o>s||void 0===s?a?-1:1:a?1:-1}},e}(),$t=function(){var e=function(e){var t=[];e.forEach(function(e){if(e instanceof $t)t=t.concat(e.orderByClauses);else{if(!(e instanceof Ut))throw new Error("Invalid argument to CompositeOrderByClause ctor.");t.push(e)}}),this._orderByClauses=t},t=new Bt({prototype:!0});return e.prototype=t,t.validate=function(e){this._orderByClauses.forEach(function(t){t.validate(e)})},t.toODataFragment=function(e){var t=this._orderByClauses.map(function(t){return t.toODataFragment(e)});return t.join(",")},t.getComparer=function(e){var t=this._orderByClauses.map(function(t){return t.getComparer(e)});return function(e,n){for(var r=0;r<t.length;r++){var a=t[r](e,n);if(0!==a)return a}return 0}},e}(),Gt=function(){var e=function(e){this.propertyPaths=e,this._pathNames=e.map(function(e){return e.replace(".","_")})},t=e.prototype;return t.validate=function(e){e&&this.propertyPaths.forEach(function(t){e.getProperty(t,!0)})},t.toODataFragment=function(e){var t=this.propertyPaths.map(function(t){return e._clientPropertyPathToServer(t)}).join(",");return t},t.toFunction=function(){var e=this;return function(t){var n={};return e.propertyPaths.forEach(function(r,a){n[e._pathNames[a]]=W(t,r)}),n}},e}(),Qt=function(){var e=function(e){this.propertyPaths=e},t=e.prototype;return t.toODataFragment=function(e){var t=this.propertyPaths.map(function(t){return e._clientPropertyPathToServer(t)}).join(",");return t},e}();X.FilterQueryOp=jt,X.Predicate=qt,X.EntityQuery=It,X.FnNode=Rt,X.OrderByClause=Bt;var Jt=function(){var e=new ut("MergeStrategy");return e.PreserveChanges=e.addSymbol(),e.OverwriteChanges=e.addSymbol(),e.SkipMerge=e.addSymbol(),e.Disallowed=e.addSymbol(),e.resolveSymbols(),e}(),Ht=function(){var e=new ut("FetchStrategy");return e.FromServer=e.addSymbol(),e.FromLocalCache=e.addSymbol(),e.resolveSymbols(),e}(),Zt=function(){function e(e,t){return t&&st(t).whereParam("fetchStrategy").isEnumOf(Ht).isOptional().whereParam("mergeStrategy").isEnumOf(Jt).isOptional().whereParam("includeDeleted").isBoolean().isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="QueryOptions",t.resolve=function(e){return new Zt(h(e,["fetchStrategy","mergeStrategy","includeDeleted"]))},t.defaultInstance=new t({fetchStrategy:Ht.FromServer,mergeStrategy:Jt.PreserveChanges,includeDeleted:!1}),n.using=function(t){if(!t)return this;var n=new Zt(this);return Jt.contains(t)?t={mergeStrategy:t}:Ht.contains(t)&&(t={fetchStrategy:t}),e(n,t)},n.setAsDefault=function(){return l(this,t)},n.toJSON=function(){return y(this,{fetchStrategy:null,mergeStrategy:null,includeDeleted:!1})},t.fromJSON=function(e){return new Zt({fetchStrategy:Ht.fromName(e.fetchStrategy),mergeStrategy:Jt.fromName(e.mergeStrategy),includeDeleted:e.includeDeleted===!0})},t}();X.QueryOptions=Zt,X.FetchStrategy=Ht,X.MergeStrategy=Jt;var Wt=function(){function e(e){if(e){if(1===e.length){var t=e[0];return function(e){return e?e.entityAspect.entityState===t:!1}}return function(t){return t?e.some(function(e){return t.entityAspect.entityState===e}):!1}}return function(e){return!!e}}var t=e([St.Added,St.Modified,St.Deleted]),n=function(e,t){this.entityManager=e,this.entityType=t,this.entityType.isFrozen=!0,this._indexMap={},this._entities=[],this._emptyIndexes=[]},r=n.prototype;return r.attachEntity=function(e,t,n){var r=e.entityAspect;r._initialized||this.entityType._initializeInstance(e),delete r._initialized;var a=r.getKey()._keyInGroup,i=this._indexMap[a];if(i>=0){var o=this._entities[i],s=o.entityAspect.entityState,u=s.isUnchanged();if(o===e)r.entityState=t;else{if(n===Jt.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+r.getKey());if(n===Jt.OverwriteChanges||n===Jt.PreserveChanges&&u){var p=this.entityManager.helper.unwrapInstance(e);this.entityType._updateTargetFromRaw(o,p,Ct.getRawValueFromServer),o.entityAspect.setEntityState(t)}}return o}return 0===this._emptyIndexes.length?i=this._entities.push(e)-1:(i=this._emptyIndexes.pop(),this._entities[i]=e),this._indexMap[a]=i,r.entityState=t,r.entityGroup=this,r.entityManager=this.entityManager,e},r.detachEntity=function(e){var t=e.entityAspect,n=t.getKey()._keyInGroup,r=this._indexMap[n];if(void 0===r)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[n],this._emptyIndexes.push(r),this._entities[r]=null,e},r.findEntityByKey=function(e){var t;t=e instanceof Et?e._keyInGroup:Et.createKeyString(e);var n=this._indexMap[t];return void 0!==n?this._entities[n]:null},r.hasChanges=function(){return this._entities.some(t)},r.getEntities=function(t){var n=e(t);return this._entities.filter(n)},r._clear=function(){this._entities.forEach(function(e){null!=e&&e.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},r._updateFkVal=function(e,t,n){var r=e.name;this._entities.forEach(function(e){null!=e&&e.getProperty(r)==t&&e.setProperty(r,n)})},r._fixupKey=function(e,t){var n=this._indexMap[e];if(void 0===n)throw new Error("Internal Error in key fixup - unable to locate entity");var r=this._entities[n],a=r.entityType.keyProperties[0].name;r.setProperty(a,t),delete r.entityAspect.hasTempKey,delete this._indexMap[e],this._indexMap[t]=n},r._replaceKey=function(e,t){var n=this._indexMap[e._keyInGroup];delete this._indexMap[e._keyInGroup],this._indexMap[t._keyInGroup]=n},n}(),Yt=function(){function e(e,t,n){var r=n?Zt.defaultInstance:e.queryOptions,a=n?en.defaultInstance:e.saveOptions,i=n?dt.defaultInstance:e.validationOptions,o=st(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Tt).whereParam("queryOptions").isInstanceOf(Zt).isOptional().withDefault(r).whereParam("saveOptions").isInstanceOf(en).isOptional().withDefault(a).whereParam("validationOptions").isInstanceOf(dt).isOptional().withDefault(i).whereParam("keyGeneratorCtor").isFunction().isOptional();n&&(o=o.whereParam("metadataStore").isInstanceOf(bt).isOptional().withDefault(new bt)),o.applyAll(e),c(e.queryOptions,r),c(e.saveOptions,a),c(e.validationOptions,i),t.serviceName&&(e.dataService=new Tt({serviceName:e.serviceName})),e.serviceName=e.dataService&&e.dataService.serviceName,e.keyGeneratorCtor=e.keyGeneratorCtor||Dt,(n||t.keyGeneratorCtor)&&(e.keyGenerator=new e.keyGeneratorCtor)}function n(e){e.forEach(function(e){var n=[],r=e.entityAspect;t(r._validationErrors,function(e,t){t.isServerError&&n.push(e)}),0!==n.length&&r._processValidationOpAndPublish(function(){n.forEach(function(e){r._removeValidationError(e)})})})}function a(e){var n=[];return e.forEach(function(e){t(e.entityAspect._validationErrors,function(t,r){var a=p({entity:e,errorName:r.validator.name},r,["errorMessage","propertyName","isServerError"]);n.push(a)})}),n}function i(e,t){var n=t.entityErrors;if(n){var r=e.entityManager,a=r.metadataStore;t.entityErrors=n.map(function(e){var t=null;if(e.keyValues){var n=a._getEntityType(e.entityTypeName),i=new Et(n,e.keyValues);t=r.findEntityByKey(i)}if(t){var o=e.propertyName?{propertyName:e.propertyName,property:n.getProperty(e.propertyName)}:{},s=ht.getKey(e.errorName||e.errorMessage,e.propertyName),u=new ht(null,o,e.errorMessage,s);u.isServerError=!0,t.entityAspect.addValidationError(u)}var c=p({entity:t,isServerError:!0},e,["errorName","errorMessage","propertyName"]);return c})}}function o(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!==t[n])return!1;return!0}function s(e,t){var n,r=h(e,t),a=r.entityKey,i=0===r.remainingArgs.length?!1:!!r.remainingArgs[0],o=!1;return i&&(n=e.getEntityByKey(a),o=!!n,o&&!e.queryOptions.includeDeleted&&n.entityAspect.entityState.isDeleted()&&(n=null,o=e.queryOptions.mergeStrategy!==Jt.OverwriteChanges)),o?Pt.resolve({entity:n,entityKey:a,fromCache:!0}):It.fromEntityKey(a).using(e).execute().then(function(e){return n=0===e.results.length?null:e.results[0],Pt.resolve({entity:n,entityKey:a,fromCache:!1})})}function l(e,t){return it(t,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(Ot).or().isNonEmptyArray().isInstanceOf(Ot).check(),"string"==typeof t?t=e.metadataStore._getEntityType(t,!1):Array.isArray(t)&&"string"==typeof t[0]&&(t=t.map(function(t){return e.metadataStore._getEntityType(t,!1)})),t}function y(e,t,n){var r,a=k(e,t);return a.forEach(function(e){if(e){var t=e.getEntities(n);r?r.push.apply(r,t):r=t}}),r||[]}function h(e,t){try{if(t[0]instanceof Et)return{entityKey:t[0],remainingArgs:tt(t,1)};if(t.length>=2){var n="string"==typeof t[0]?e.metadataStore._getEntityType(t[0],!1):t[0];return{entityKey:new Et(n,t[1]),remainingArgs:tt(t,2)}}}catch(r){}throw new Error("Must supply an EntityKey OR an EntityType name or EntityType followed by a key value or an array of key values.")}function g(e,t){e.forEach(function(e){e.entityAspect.isBeingSaved=t})}function E(e,n){var r;n?(r={},n.forEach(function(e){var t=r[e.entityType.name];t||(t={},t.entityType=e.entityType,t._entities=[],r[e.entityType.name]=t),t._entities.push(e)})):r=e._entityGroupMap;var a=[],i={};return t(r,function(e,t){i[e]=T(t,a)}),{entityGroupMap:i,tempKeys:a}}function T(e,t){var n={},r=e.entityType,a=r.dataProperties,i=W(r),o=[];return e._entities.forEach(function(e){if(e){var n=P(e,a,i,t);o.push(n)}}),n.entities=o,n}function P(e,t,n,r){var a={};t.forEach(function(t){var r=t.name,i=e.getProperty(r);if(null!=i||null!=t.defaultValue){if(i&&t.isComplexProperty){var o=t.dataType.dataProperties;i=m(i,function(e){return P(e,o,n)})}else i=n?n(t,i):i,t.isUnmapped&&(i=f(i));void 0!==i&&(a[r]=i)}});var i,o;if(e.entityAspect){i=e.entityAspect;var s=i.entityState;o={tempNavPropNames:b(i,r),entityState:s.name},i.extraMetadata&&(o.extraMetadata=i.extraMetadata),(s.isModified()||s.isDeleted())&&(o.originalValuesMap=i.originalValues),a.entityAspect=o}else i=e.complexAspect,o={},i.originalValues&&!V(i.originalValues)&&(o.originalValuesMap=i.originalValues),a.complexAspect=o;return a}function b(e,t){var n=e.entity;e.hasTempKey&&t.push(e.getKey().toJSON());var r;return n.entityType.navigationProperties.forEach(function(e){if(e.relatedDataProperties){var t=n.getProperty(e.name);t&&t.entityAspect.hasTempKey&&(r=r||[],r.push(e.name))}}),r}function A(e,t,n){var r=n.tempKeyMap,a=e.entityType,i=n.mergeStrategy,o=null,s=e.entityManager,u=s.entityChanged,p=[],c=Ct.getRawValueFromClient;return t.entities.forEach(function(t){var n,l=t.entityAspect,y=a.getEntityKeyFromRawEntity(t,c),f=St.fromName(l.entityState);if(f.isAdded()?(n=F(r,y),o=void 0===n?e.findEntityByKey(y):null):o=e.findEntityByKey(y),o)if(i===Jt.SkipMerge);else{if(i===Jt.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+y.toString()+" from being merged");var h=o.entityAspect.entityState,d=h.isUnchanged();(i===Jt.OverwriteChanges||d)&&(a._updateTargetFromRaw(o,t,c),o.entityAspect.setEntityState(f),u.publish({entityAction:mt.MergeOnImport,entity:o}))}else o=a._createInstanceCore(),a._updateTargetFromRaw(o,t,c),null!=n&&(o.entityAspect.hasTempKey=!0,o.setProperty(a.keyProperties[0].name,n.values[0]),l.tempNavPropNames&&l.tempNavPropNames.forEach(function(e){var t=a.getNavigationProperty(e),n=t.relatedDataProperties[0].name,i=o.getProperty(n),s=new Et(t.entityType,[i]),u=F(r,s);o.setProperty(n,u.values[0])})),o=e.attachEntity(o,f),u.publish({entityAction:mt.AttachOnImport,entity:o}),f.isUnchanged()||s._notifyStateChange(o,!0);p.push(o)}),p}function F(e,t){var n=e[t.toString()];if(n)return n;var r=t._subtypes;if(!r)return null;for(var a=0,i=r.length;i>a;a++)if(n=e[t.toString(r[a])])return n;return null}function x(e,t,n){return e=e.then(function(e){return t&&t(e),Pt.resolve(e)},function(e){return n&&n(e),Pt.reject(e)})}function D(e,t){var n;return n=t?t.filter(function(t){if(t.entityAspect.entityManager!==e)throw new Error("Only entities in this entityManager may be saved");return!t.entityAspect.entityState.isDetached()}):e.getChanges()}function M(e,t){e._inKeyFixup=!0,t.forEach(function(t){var n=e._entityGroupMap[t.entityTypeName];if(!n)throw new Error("Unable to locate the following fully qualified EntityType name: "+t.entityTypeName);n._fixupKey(t.tempValue,t.realValue)}),e._inKeyFixup=!1}function k(e,t){var n=e._entityGroupMap;return t?d(t).map(function(e){if(e instanceof Ot)return n[e.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}):u(n)}function I(e,t){var n=t.entityAspect.getKey(),r=w(t.entityType.keyProperties,n.values,function(e,t){return e.defaultValue===t?e:null}).filter(function(e){return null!==e});if(r.length)if(t.entityType.autoGeneratedKeyType!==xt.None)e.generateTempKeyValue(t);else if(r.length===n.values.length)throw new Error("Cannot attach an object of type  ("+t.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function R(e,t){return t?(t=d(t),t.forEach(function(e){if(!St.contains(e))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}),t):null}function j(e,t,n,r){var a=t.entityType.navigationProperties;a.forEach(function(a){var i=t.getProperty(a.name);if(a.isScalar){if(!i)return;e.attachEntity(i,n,r)}else i.forEach(function(t){e.attachEntity(t,n,r)})})}function K(e,t,n,a){try{var i,o=e.metadataStore;if(o.isEmpty()&&a.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(n.fetchStrategy===Ht.FromLocalCache)try{return i=e.executeQueryLocally(t),Pt.resolve({results:i,query:t})}catch(s){return Pt.reject(s)}var u=new Xt({query:t,entityManager:e,dataService:a,mergeOptions:{mergeStrategy:n.mergeStrategy,noTracking:!!t.noTrackingEnabled}}),p=e.validationOptions.validateOnQuery;return a.adapterInstance.executeQuery(u).then(function(n){var o=O(function(){var t={isLoading:e.isLoading};return e.isLoading=!0,e._pendingPubs=[],t},function(n){e.isLoading=n.isLoading,e._pendingPubs.forEach(function(e){e()}),e._pendingPubs=null,e._hasChangesAction&&e._hasChangesAction(),t=null,u=null,n.error&&Pt.reject(n.error)},function(){var o=a.jsonResultsAdapter.extractResults(n);o=d(o),i=u.visitAndMerge(o,{nodeType:"root"}),p&&i.forEach(function(e){e.entityAspect&&e.entityAspect.validateEntity()}),u.processDeferred(),q(i,t);var s=r(u.refMap);return{results:i,query:t,entityManager:e,httpResponse:n.httpResponse,inlineCount:n.inlineCount,retrievedEntities:s}});return Pt.resolve(o)},function(n){return n&&(n.query=t,n.entityManager=e),Pt.reject(n)})}catch(s){return s&&(s.query=t),Pt.reject(s)}}function q(e,t){if(!t.noTrackingEnabled){var n=t.expandClause;null!=n&&n.propertyPaths.forEach(function(t){var n=t.split(".");L(e,n)})}}function L(e,t){var n=t[0];e.forEach(function(e){var r=e.entityAspect;if(r&&(r._markAsLoaded(n),1!==t.length)){var a=e.getProperty(n);a&&(a.arrayChanged||(a=[a]),L(a,t.slice(1)))}})}function z(e){var t=e.filter(function(e){return e.entityAspect.isBeingSaved=!0,e.entityAspect.entityState.isModified()&&e.entityType.concurrencyProperties.length>0});0!==t.length&&t.forEach(function(e){e.entityType.concurrencyProperties.forEach(function(t){B(e,t)})})}function B(e,t){if(!e.entityAspect.originalValues[t.name]){var n=e.getProperty(t.name);if(n||(n=t.dataType.defaultValue),t.dataType.isNumeric)e.setProperty(t.name,n+1);else if(t.dataType.isDate){for(var r=new Date,a=new Date;r.getTime()===a.getTime();)a=new Date;e.setProperty(t.name,a)}else{if(t.dataType!==wt.Guid){if(t.dataType===wt.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+t.name)}e.setProperty(t.name,C())
}}}function U(e,t){var n=e._entityGroupMap[t.name];return n||(n=new Wt(e,t),e._entityGroupMap[t.name]=n),n}function $(e,t){var n=t.getSelfAndSubtypes();return n.map(function(t){return U(e,t)})}function G(e,t){var n={},r=e.entityType||e.complexType,a=W(r),i={};return r.dataProperties.forEach(function(r){if(r.isComplexProperty)n[r.nameOnServer]=m(e.getProperty(r.name),function(e){return G(e,t)});else{var o=e.getProperty(r.name);if(o=t?t(r,o):o,void 0===o)return;o=a?a(r,o):o,void 0!==o&&(r.isUnmapped?i[r.nameOnServer]=f(o):n[r.nameOnServer]=o)}}),V(i)||(n.__unmapped=i),n}function Q(e,n,r){var a=e.entityType||e.complexType,i=e.entityAspect||e.complexAspect,o=n.namingConvention.clientPropertyNameToServer,s={};return t(i.originalValues,function(e,t){var n=a.getProperty(e);t=r?r(n,t):t,void 0!==t&&(s[o(e,n)]=t)}),a.complexProperties.forEach(function(t){var a=e.getProperty(t.name);if(t.isScalar){var i=Q(a,n,r);V(i)||(s[o(t.name,t)]=i)}else{var u=a.map(function(e){return Q(e,n,r)});s[o(t.name,t)]=u}}),s}function J(e,n,r){var a=e.entityType,i=W(a),o=n.namingConvention.clientPropertyNameToServer,s={};return t(e.entityAspect.originalValues,function(t){var n=a.getProperty(t),u=e.getProperty(t);u=r?r(n,u):u,void 0!==u&&(u=i?i(n,u):u,void 0!==u&&(s[o(t,n)]=u))}),a.complexProperties.forEach(function(t){if(H(e,t)){var n=e.getProperty(t.name);s[o(t.name,t)]=m(n,function(e){return G(e,r)})}}),s}function H(e,t){var n=e.getProperty(t.name);return t.isScalar?Z(n):n._origValues?!0:n.some(function(e){return Z(e)})}function Z(e){return V(e.complexAspect.originalValues)?e.complexType.complexProperties.some(function(t){return H(e,t)}):!0}function W(e){return e.serializerFn||e.metadataStore&&e.metadataStore.serializerFn}function Y(){this.map={}}var et=function(t){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?t={serviceName:""}:"string"==typeof t&&(t={serviceName:t}),e(this,t,!0),this.entityChanged=new pt("entityChanged",this),this.validationErrorsChanged=new pt("validationErrorsChanged",this),this.hasChangesChanged=new pt("hasChangesChanged",this),this.clear()},nt=et.prototype;return nt._$typeName="EntityManager",pt.bubbleEvent(nt,null),nt.setProperties=function(t){e(this,t,!1)},nt.createEntity=function(e,t,n,r){it(e,"entityType").isString().or().isInstanceOf(Ot).check(),it(n,"entityState").isEnumOf(St).isOptional().check(),it(r,"mergeStrategy").isEnumOf(Jt).isOptional().check(),"string"==typeof e&&(e=this.metadataStore._getEntityType(e)),n=n||St.Added;var a;return N(this,"isLoading",!0,function(){a=e.createEntity(t)}),n!==St.Detached&&(a=this.attachEntity(a,n,r)),a},et.importEntities=function(e,t){var n=new Yt;return n.importEntities(e,t),n},nt.acceptChanges=function(){this.getChanges().forEach(function(e){e.entityAspect.acceptChanges()})},nt.exportEntities=function(e,t){it(t,"includeMetadata").isBoolean().isOptional().check(),t=null==t?!0:t;var n=E(this,e),r=p({},n,["tempKeys","entityGroupMap"]);t?(r=p(r,this,["dataService","saveOptions","queryOptions","validationOptions"]),r.metadataStore=this.metadataStore.exportMetadata()):(r.metadataVersion=X.metadataVersion,r.metadataStoreName=this.metadataStore.name);var a=JSON.stringify(r,null,ct.stringifyPad);return a},nt.importEntities=function(e,n){n=n||{},st(n).whereParam("mergeStrategy").isEnumOf(Jt).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(n);var r=this,a="string"==typeof e?JSON.parse(e):e;a.metadataStore?(this.metadataStore.importMetadata(a.metadataStore),this.dataService=a.dataService&&Tt.fromJSON(a.dataService)||new Tt({serviceName:a.serviceName}),this.saveOptions=new en(a.saveOptions),this.queryOptions=Zt.fromJSON(a.queryOptions),this.validationOptions=new dt(a.validationOptions)):n.metadataVersionFn&&n.metadataVersionFn({metadataVersion:a.metadataVersion,metadataStoreName:a.metadataStoreName});var i={};a.tempKeys.forEach(function(e){var t=Et.fromJSON(e,r.metadataStore);i[t.toString()]=new Et(t.entityType,r.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))});var o=[];return n.tempKeyMap=i,O(function(){r._pendingPubs=[]},function(){r._pendingPubs.forEach(function(e){e()}),r._pendingPubs=null,r._hasChangesAction&&r._hasChangesAction()},function(){t(a.entityGroupMap,function(e,t){var a=r.metadataStore._getEntityType(e,!0),i=U(r,a),s=A(i,t,n);Array.prototype.push.apply(o,s)}),o.forEach(function(e){r._linkRelatedEntities(e)})}),{entities:o,tempKeyMapping:i}},nt.clear=function(){t(this._entityGroupMap,function(e,t){t._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new Y,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:mt.Clear}),this._setHasChanges(!1)},nt.createEmptyCopy=function(){var e=new et(p({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]));return e},nt.addEntity=function(e){return this.attachEntity(e,St.Added)},nt.attachEntity=function(e,t,n){if(it(e,"entity").isRequired().check(),this.metadataStore._checkEntityType(e),t=it(t,"entityState").isEnumOf(St).isOptional().check(St.Unchanged),n=it(n,"mergeStrategy").isEnumOf(Jt).isOptional().check(Jt.Disallowed),e.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType ("+e.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var r=e.entityAspect;if(r){if(r._inProcessEntity)return r._inProcessEntity}else r=new vt(e);var a=r.entityManager;if(a){if(a===this)return e;throw new Error("This entity already belongs to another EntityManager")}var i,o=this;return N(this,"isLoading",!0,function(){t.isAdded()&&I(o,e),i=o._attachEntityCore(e,t,n),r._inProcessEntity=i;try{j(o,e,t,n)}finally{r._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&i.entityAspect.validateEntity(),t.isUnchanged()||this._notifyStateChange(i,!0),this.entityChanged.publish({entityAction:mt.Attach,entity:i}),i},nt.detachEntity=function(e){it(e,"entity").isEntity().check();var t=e.entityAspect;if(!t)return!1;if(t.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return t.setDetached()},nt.fetchMetadata=function(e,t,n){"function"==typeof e?(n=t,t=e,e=null):(it(e,"dataService").isInstanceOf(Tt).isOptional().check(),it(t,"callback").isFunction().isOptional().check(),it(n,"errorCallback").isFunction().isOptional().check());var r=this.metadataStore.fetchMetadata(e||this.dataService);return x(r,t,n)},nt.executeQuery=function(e,t,n){it(e,"query").isInstanceOf(It).or().isString().check(),it(t,"callback").isFunction().isOptional().check(),it(n,"errorCallback").isFunction().isOptional().check();var r,a=Zt.resolve([e.queryOptions,this.queryOptions,Zt.defaultInstance]),i=Tt.resolve([e.dataService,this.dataService]);if(!i.hasServerMetadata||this.metadataStore.hasMetadataFor(i.serviceName))r=K(this,e,a,i);else{var o=this;r=this.fetchMetadata(i).then(function(){return K(o,e,a,i)})}return x(r,t,n)},nt.executeQueryLocally=function(e){it(e,"query").isInstanceOf(It).check();var t=this.metadataStore,n=e._getFromEntityType(t,!0),r=$(this,n),a=e._toFilterFunction(n),i=Zt.resolve([e.queryOptions,this.queryOptions,Zt.defaultInstance]),o=i.includeDeleted===!0,s=function(e){return e&&(o||!e.entityAspect.entityState.isDeleted())&&(a?a(e):!0)},u=[];r.forEach(function(e){u.push.apply(u,e._entities.filter(s))});var p=e._toOrderByComparer(n);p&&u.sort(p);var c=e.skipCount;c&&(u=u.slice(c));var l=e.takeCount;l&&(u=u.slice(0,l));var y=e.selectClause;if(y){var f=y.toFunction();u=u.map(function(e){return f(e)})}return u},nt.saveChanges=function(e,t,r,s){function u(e){var t=S.entityManager,n=e.entities=S.processSavedEntities(e),a=l&&o(y,n)?!1:null;return t._setHasChanges(a),g(y,!1),r&&r(e),Pt.resolve(e)}function p(e){var t=e.entities;if(0===t.length)return[];var n=e.keyMappings,r=S.entityManager;return M(r,n),N(r,"isLoading",!0,function(){var e=new Xt({query:null,entityManager:r,mergeOptions:{mergeStrategy:Jt.OverwriteChanges},dataService:E});t=e.visitAndMerge(t,{nodeType:"root"})}),t}function c(e){return g(y,!1),i(S,e),s&&s(e),Pt.reject(e)}it(e,"entities").isOptional().isArray().isEntity().check(),it(t,"saveOptions").isInstanceOf(en).isOptional().check(),it(r,"callback").isFunction().isOptional().check(),it(s,"errorCallback").isFunction().isOptional().check(),t=t||this.saveOptions||en.defaultInstance;var l=null==e,y=D(this,e);if(0===y.length){var f={entities:[],keyMappings:[]};return r&&r(f),Pt.resolve(f)}if(!t.allowConcurrentSaves){var h=y.some(function(e){return e.entityAspect.isBeingSaved});if(h){var d=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return s&&s(d),Pt.reject(d)}}if(n(y),this.validationOptions.validateOnSave){var m=y.filter(function(e){var t=e.entityAspect,n=t.entityState.isDeleted()||t.validateEntity();return!n});if(m.length>0){var v=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");return v.entityErrors=a(m),s&&s(v),Pt.reject(v)}}var E=Tt.resolve([t.dataService,this.dataService]),S={entityManager:this,dataService:E,processSavedEntities:p,resourceName:t.resourceName||this.saveOptions.resourceName||"SaveChanges"},w={entities:y,saveOptions:t};try{return z(y),E.adapterInstance.saveChanges(S,w).then(u).then(null,c)}catch(d){return g(y,!1),s&&s(d),Pt.reject(d)}},nt._findEntityGroup=function(e){return this._entityGroupMap[e.name]},nt.getEntityByKey=function(){var e=h(this,arguments).entityKey,t=e._subtypes||[e.entityType],n=null;return t.some(function(t){var r=this._findEntityGroup(t);return n=r&&r.findEntityByKey(e)},this),n},nt.fetchEntityByKey=function(){var e=Tt.resolve([this.dataService]);if(!e.hasServerMetadata||this.metadataStore.hasMetadataFor(e.serviceName))return s(this,arguments);var t=this,n=arguments;return this.fetchMetadata(e).then(function(){return s(t,n)})},nt.findEntityByKey=function(e){return this.getEntityByKey(e)},nt.generateTempKeyValue=function(e){it(e,"entity").isEntity().check();var t=e.entityType,n=this.keyGenerator.generateTempKeyValue(t),r=t.keyProperties[0];return e.setProperty(r.name,n),e.entityAspect.hasTempKey=!0,n},nt.hasChanges=function(e){return this._hasChanges?void 0===e?this._hasChanges:this._hasChangesCore(e):!1},nt._hasChangesCore=function(e){e=l(this,e);var t=k(this,e);return t.some(function(e){return e.hasChanges()})},nt.getChanges=function(e){e=l(this,e);var t=[St.Added,St.Modified,St.Deleted];return y(this,e,t)},nt.rejectChanges=function(){if(!this._hasChanges)return[];var e=[St.Added,St.Modified,St.Deleted],t=y(this,null,e);return this._hasChanges=!1,t.forEach(function(e){e.entityAspect.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),t},nt.getEntities=function(e,t){return e=l(this,e),it(t,"entityStates").isOptional().isEnumOf(St).or().isNonEmptyArray().isEnumOf(St).check(),t=t&&R(this,t),y(this,e,t)},nt._notifyStateChange=function(e,t){var n={entityAction:mt.EntityStateChange,entity:e};t?this._hasChanges||(this._setHasChanges(!0),this.entityChanged.publish(n)):this._hasChanges&&(this.isLoading?this._hasChangesAction=this._hasChangesAction||function(){this._setHasChanges(null),this.entityChanged.publish(n)}.bind(this):(this._setHasChanges(null),this.entityChanged.publish(n)))},nt._setHasChanges=function(e){null==e&&(e=this._hasChangesCore());var t=this._hasChanges;this._hasChanges=e,e!=t&&this.hasChangesChanged.publish({entityManager:this,hasChanges:e}),this._hasChangesAction=null},nt._linkRelatedEntities=function(e){var t=this,n=e.entityAspect;N(t,"isLoading",!0,function(){var r=t._unattachedChildrenMap,a=n.getKey(),i=r.getTuples(a);i&&i.slice(0).forEach(function(t){var n,i,o=t.children.filter(function(e){return e.entityAspect.entityState!==St.Detached}),s=t.navigationProperty;if(s.inverse)if(n=s,i=s.inverse,i.isScalar){var u=o[0];e.setProperty(i.name,u),u.setProperty(n.name,e)}else{var p=e.getProperty(i.name);o.forEach(function(t){p.push(t),t.setProperty(n.name,e)})}else if(s.parentType===e.entityType)if(i=s,i.isScalar)e.setProperty(i.name,o[0]);else{var p=e.getProperty(i.name);o.forEach(function(e){p._push(e)})}else n=s,o.forEach(function(t){t.setProperty(n.name,e)});r.removeChildren(a,n)}),e.entityType.navigationProperties.forEach(function(a){if(a.isScalar){var i=e.getProperty(a.name);if(i)return}var o=n.getParentKey(a);if(o){if(o._isEmpty())return;var s=t.findEntityByKey(o);s?e.setProperty(a.name,s):r.addChild(o,a,e)}}),e.entityType.foreignKeyProperties.forEach(function(n){var a=n.inverseNavigationProperty;if(a){var i=e.getProperty(n.name),o=new Et(a.parentType,[i]),s=t.findEntityByKey(o);s?a.isScalar?s.setProperty(a.name,e):t.isLoading?s.getProperty(a.name)._push(e):s.getProperty(a.name).push(e):r.addChild(o,a,e)}})})},nt._attachEntityCore=function(e,t,n){var r=U(this,e.entityType),a=r.attachEntity(e,t,n);return this._linkRelatedEntities(a),a},nt._updateFkVal=function(e,t,n){var r=this._entityGroupMap[e.parentType.name];r&&r._updateFkVal(e,t,n)},nt.helper={unwrapInstance:G,unwrapOriginalValues:Q,unwrapChangedValues:J},Y.prototype.addChild=function(e,t,n){var r=this.getTuple(e,t);r||(r={navigationProperty:t,children:[]},_(this.map,e.toString()).push(r)),r.children.push(n)},Y.prototype.removeChildren=function(e,t){var n=this.getTuples(e);n&&(S(n,function(e){return e.navigationProperty===t}),n.length||delete this.map[e.toString()])},Y.prototype.getChildren=function(e,t){var n=this.getTuple(e,t);return n?n.children.filter(function(e){return!e.entityAspect.entityState.isDetached()}):null},Y.prototype.getTuple=function(e,t){var n=this.getTuples(e);if(!n)return null;var r=v(n,function(e){return e.navigationProperty===t});return r},Y.prototype.getTuples=function(e){for(var t=this.map[e.toString()],n=e.entityType;!t&&n.baseEntityType;){n=n.baseEntityType;var r=e.toString(n);t=this.map[r]}return t},et}();X.EntityManager=Yt;var Xt=function(){function e(e,t,a,o){if(a.ignore||null==t)return null;if(a.nodeRefId){var u=i(e,a.nodeRefId);return"function"==typeof u&&null!=o?void e.deferredFns.push(function(){o(u)}):u}if(a.entityType){var p=a.entityType;return e.mergeOptions.noTracking?(t=n(e,p,t),p.noTrackingFn&&(t=p.noTrackingFn(t,p)),a.nodeId&&(e.refMap[a.nodeId]=t),t):p.isComplexType?n(e,p,t):s(e,t,a)}return"object"!=typeof t||D(t)||(t=r(e,t)),a.nodeId&&(e.refMap[a.nodeId]=t),t}function n(e,t,r){var i={};return t.dataProperties.forEach(function(t){i[t.name]=t.isComplexProperty?m(r[t.nameOnServer],function(r){return n(e,t.dataType,r)}):S(r[t.nameOnServer],t.dataType)}),t.navigationProperties&&t.navigationProperties.forEach(function(t){var n={nodeType:"navProp",navigationProperty:t};a(r[t.nameOnServer],e,n,i,t.name)}),i}function r(e,n){var r=e.metadataStore.namingConvention.serverPropertyNameToClient,i={};return t(n,function(t,n){var o=r(t),s={nodeType:"anonProp",propertyName:o};a(n,e,s,i,o)}),i}function a(t,n,r,a,i){var o=n.jsonResultsAdapter,s=o.visitNode(t,n,r)||{};t=s.node||t,s.ignore||(Array.isArray(t)?(r.nodeType=r.nodeType+"Item",a[i]=t.map(function(t,u){return s=o.visitNode(t,n,r)||{},t=s.node||t,e(n,t,s,function(e){a[i][u]=e()})})):a[i]=e(n,t,s,function(e){a[i]=e()}))}function i(e,t){var n=e.refMap[t];return void 0===n?function(){return e.refMap[t]}:n}function o(e,t,n){var r=n._$meta.nodeId;null!=r&&(e.refMap[r]=t)}function s(e,t,n){t._$meta=n;var r=e.entityManager,a=n.entityType;"string"==typeof a&&(a=e.metadataStore._getEntityType(a,!1)),t.entityType=a;var i=e.mergeOptions.mergeStrategy,o=null==e.query,s=a.getEntityKeyFromRawEntity(t,e.rawValueFn),p=r.findEntityByKey(s);if(p){if(o&&p.entityAspect.entityState.isDeleted())return r.detachEntity(p),p;var l=p.entityAspect.entityState;if(i===Jt.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+s.toString()+" from being merged");if(i===Jt.SkipMerge)u(e,p,t);else if(i===Jt.OverwriteChanges||l.isUnchanged()){c(e,p,t),p.entityAspect.wasLoaded=!0,n.extraMetadata&&(p.entityAspect.extraMetadata=n.extraMetadata),p.entityAspect.entityState=St.Unchanged,p.entityAspect.originalValues={},p.entityAspect.propertyChanged.publish({entity:p,propertyName:null});var y=o?mt.MergeOnSave:mt.MergeOnQuery;r.entityChanged.publish({entityAction:y,entity:p}),l.isUnchanged()||r._notifyStateChange(p,!1)}else u(e,p,t)}else p=a._createInstanceCore(),c(e,p,t),n.extraMetadata&&(p.entityAspect.extraMetadata=n.extraMetadata),r._attachEntityCore(p,St.Unchanged,Jt.Disallowed),p.entityAspect.wasLoaded=!0,r.entityChanged.publish({entityAction:mt.AttachOnQuery,entity:p});return p}function u(e,t,n){o(e,t,n),n.entityType.navigationProperties.forEach(function(t){t.isScalar?f(e,n,t):h(e,n,t)})}function c(e,t,n){o(e,t,n);var r=t.entityType;r._updateTargetFromRaw(t,n,e.rawValueFn),r.navigationProperties.forEach(function(r){r.isScalar?l(e,r,t,n):y(e,r,t,n)})}function l(e,t,n,r){var a=f(e,r,t);null!=a&&("function"==typeof a?e.deferredFns.push(function(){a=a(),d(a,n,t)}):d(a,n,t))}function y(e,t,n,r){var a=h(e,r,t);if(null!=a){var i=t.inverse;if(i){var o=n.getProperty(t.name);o.wasLoaded=!0,a.forEach(function(t){"function"==typeof t?e.deferredFns.push(function(){t=t(),v(t,o,n,i)}):v(t,o,n,i)})}}}function f(e,t,n){var r=t[n.nameOnServer];if(!r)return null;var a=e.visitAndMerge(r,{nodeType:"navProp",navigationProperty:n});return a}function h(e,t,n){var r=t[n.nameOnServer];if(!r)return null;if(!Array.isArray(r)&&(r=r.results,!r))return null;var a=e.visitAndMerge(r,{nodeType:"navPropItem",navigationProperty:n});return a}function d(e,t,n){if(e){var r=n.name,a=t.getProperty(r);if(a!==e){t.setProperty(r,e);var i=n.inverse;if(!i)return;if(i.isScalar)e.setProperty(i.name,t);else{var o=e.getProperty(i.name);o.push(t)}}}}function v(e,t,n,r){if(e){var a=e.getProperty(r.name);a!==n&&(t.push(e),e.setProperty(r.name,n))}}var g=function(e){p(this,e,["query","entityManager","dataService","mergeOptions"]),this.refMap={},this.deferredFns=[],this.jsonResultsAdapter=this.dataService.jsonResultsAdapter,this.metadataStore=this.entityManager.metadataStore,this.rawValueFn=Ct.getRawValueFromServer},E=g.prototype,S=wt.parseRawValue;return E._$typeName="MappingContext",E.getUrl=function(){return this.dataService.makeUrl(this.metadataStore.toQueryString(this.query))},E.visitAndMerge=function(t,n){var r=this.query,a=this.jsonResultsAdapter;n=n||{};var i=this;return m(t,function(t){if(null==r&&t.entityAspect)return t.entityAspect.entityState.isDeleted()?i.entityManager.detachEntity(t):t.entityAspect.acceptChanges(),t;var o=a.visitNode(t,i,n)||{};return t=o.node||t,r&&"root"===n.nodeType&&!o.entityType&&(o.entityType=r._getToEntityType&&r._getToEntityType(i.metadataStore)),e(i,t,o)})},E.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(e){e()})},g}(),en=function(){function e(e,t){return t&&st(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Tt).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="SaveOptions",n.setAsDefault=function(){return l(this,t)},n.using=function(t){return e(this,t)},t.defaultInstance=new t({allowConcurrentSaves:!1}),t}();X.SaveOptions=en,X.AbstractDataServiceAdapter=function(){function e(){this.getRequest=function(e){return e},this.done=function(){}}function t(e,t,r){var a=n(t);return r&&(a.message=r+"; "+a.message),e.reject(a)}function n(e){var t=new Error;t.httpResponse=e,t.status=e.status;var n=e.data;if("string"==typeof n)try{n=JSON.parse(n)}catch(a){}return r(t,n,e),o._catchNoConnectionError(t),t}function r(e,t,n){if(t){var r=t;do e.message=r.ExceptionMessage||r.exceptionMessage||r.Message||r.message,r=r.InnerException;while(r);var a=n.saveContext,i=t.EntityErrors||t.entityErrors||t.Errors||t.errors;if(a&&i){var o=a.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;e.entityErrors=i.map(function(e){return{errorName:e.ErrorName,entityTypeName:bt.normalizeTypeName(e.EntityTypeName),keyValues:e.KeyValues,propertyName:e.PropertyName&&o(e.PropertyName),errorMessage:e.ErrorMessage}}),e.message||(e.message="Server side errors encountered - see the entityErrors collection on this object for more detail")}}else e.message=n.error&&n.error.toString()}var a,i=function(){},o=i.prototype;return o.checkForRecomposition=function(e){"ajax"===e.interfaceName&&e.isDefault&&this.initialize()},o.initialize=function(){if(a=X.config.getAdapterInstance("ajax"),!a||!a.ajax)throw new Error("Unable to find ajax adapter for dataservice adapter '"+(this.name||"")+"'.")},o.fetchMetadata=function(e,n){var r=n.serviceName,i=n.makeUrl("Metadata"),o=Pt.defer();return a.ajax({type:"GET",url:i,dataType:"json",success:function(a){if(e.hasMetadataFor(r))return o.resolve("already fetched");var s=a.data;try{var u="string"==typeof s?JSON.parse(s):s;e.importMetadata(u)}catch(p){var c="Unable to either parse or import metadata: "+p.message;return t(o,a,"Metadata query failed for: "+i+". "+c)}return e.hasMetadataFor(r)||e.addDataService(n),o.resolve(u)},error:function(e){t(o,e,"Metadata query failed for: "+i)}}),o.promise},o.executeQuery=function(e){var n=Pt.defer(),r=e.getUrl(),i={type:"GET",url:r,params:e.query.parameters,dataType:"json",success:function(e){var r=e.data;try{var a;a=r&&r.Results?{results:r.Results,inlineCount:r.InlineCount,httpResponse:e}:{results:r,httpResponse:e},n.resolve(a)}catch(i){i instanceof Error?n.reject(i):t(e)}},error:function(e){t(n,e)}};return e.dataService.useJsonp&&(i.dataType="jsonp",i.crossDomain=!0),a.ajax(i),n.promise},o.saveChanges=function(e,n){var r=e.adapter=this,i=Pt.defer();n=r._prepareSaveBundle(e,n);var o=JSON.stringify(n),s=e.dataService.makeUrl(e.resourceName);return a.ajax({type:"POST",url:s,dataType:"json",contentType:"application/json",data:o,success:function(n){var a=n.data;n.saveContext=e;var o=a.Errors||a.errors;if(o)t(i,n);else{var s=r._prepareSaveResult(e,a);s.httpResponse=n,i.resolve(s)}},error:function(n){n.saveContext=e,t(i,n)}}),i.promise},o._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},o.changeRequestInterceptor=e,o._createChangeRequestInterceptor=function(t,n){var r=t.adapter,a=M,i=r.changeRequestInterceptor,o=r.name+" DataServiceAdapter's ChangeRequestInterceptor",s=" is missing or not a function.";if(a(i)){var u=new i(t,n);if(!a(u.getRequest))throw new Error(o+".getRequest"+s);if(!a(u.done))throw new Error(o+".done"+s);return u}return new e(t,n)},o._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},o.jsonResultsAdapter=new _t({name:"noop",visitNode:function(){return{}}}),o._catchNoConnectionError=function(e){0==e.status&&null==e.message&&(e.message="HTTP response status 0 and no message.  Likely did not or could not reach server. Is the server running?")},i}(),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],e)}(function(e){function t(e){var n,r,a,i="";for(var o in e){var s=e[o];if(s instanceof Array)for(var u=0;u<s.length;++u)n=s[u],a=o+"["+u+"]",r={},r[a]=n,i+=t(r)+"&";else if(s instanceof Date)i+=encodeURIComponent(o)+"="+encodeURIComponent(s.toISOString())+"&";else if(s instanceof Object)for(var p in s)n=s[p],a=o+"["+p+"]",r={},r[a]=n,i+=t(r)+"&";else null===s?i+=encodeURIComponent(o)+"=&":void 0!==s&&(i+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&")}return i.length?i.substr(0,i.length-1):i}var n,r,a=e.core,i=function(){this.name="angular",this.defaultSettings={},this.requestInterceptor=null},o=i.prototype;o.initialize=function(){var e=a.requireLib("angular");if(e){var t=e.injector(["ng"]);t.invoke(["$http","$rootScope",function(e,t){n=e,r=t}])}},o.setHttp=function(e){n=e,r=null},o.ajax=function(e){function i(t,n,r,a,i){"null"===t&&(t=null);var o={config:e,data:t,getHeaders:r,status:n,statusText:i};e.success(o)}function o(t,n,r,a,i){0===n&&null==t&&(t="timeout");var o={config:e,data:t,getHeaders:r,status:n,statusText:i};e.error(o)}if(!n)throw new Error("Unable to locate angular for ajax adapter");var s={method:e.type,url:e.url,dataType:e.dataType,contentType:e.contentType,crossDomain:e.crossDomain,headers:e.headers||{}};if(e.params){var u=s.url.indexOf("?")>=0?"&":"?";s.url=s.url+u+t(e.params)}if(e.data&&(s.data=e.data),!a.isEmpty(this.defaultSettings)){var p=a.extend({},this.defaultSettings);s=a.extend(p,s),s.headers=a.extend(this.defaultSettings.headers,s.headers)}var c={adapter:this,config:s,zConfig:e,success:i,error:o};a.isFunction(this.requestInterceptor)&&(this.requestInterceptor(c),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),c.config&&(n(c.config).success(c.success).error(c.error),r&&r.$digest())},e.config.registerAdapter("ajax",i)}),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],e)}(function(e){function t(e){return 0===e.status?function(e){return e&&e.length>0?"":{}}:function(t){return t&&t.length>0?e.getResponseHeader(t):e.getAllResponseHeaders()}}var n,r=e.core,a=function(){this.name="jQuery",this.defaultSettings={},this.requestInterceptor=null},i=a.prototype;i.initialize=function(){n=r.requireLib("jQuery")},i.ajax=function(e){function a(n,r,a){var i={config:e,data:n,getHeaders:t(a),status:a.status,statusText:r};e.success(i),a.onreadystatechange=null,a.abort=null}function i(n,r,a){var i={config:e,data:n.responseText,error:a,getHeaders:t(n),status:n.status,statusText:r};e.error(i),n.onreadystatechange=null,n.abort=null}if(!n)throw new Error("Unable to locate jQuery");var o={type:e.type,url:e.url,data:e.params||e.data,dataType:e.dataType,contentType:e.contentType,crossDomain:e.crossDomain,headers:e.headers||{}};if(!r.isEmpty(this.defaultSettings)){var s=r.extend({},this.defaultSettings);o=r.extend(s,o),o.headers=r.extend(this.defaultSettings.headers,o.headers)}var u={adapter:this,config:o,zConfig:e,success:a,error:i};r.isFunction(this.requestInterceptor)&&(this.requestInterceptor(u),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),u.config&&(u.jqXHR=n.ajax(u.config).done(u.success).fail(u.error))},e.config.registerAdapter("ajax",a)}),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!X&&define(["breeze"],e)}(function(e){function t(e,t){return e.isUnmapped?void 0:(e.dataType===wt.DateTimeOffset?t=t&&new Date(t.getTime()-6e4*t.getTimezoneOffset()):e.dataType.quoteJsonOData&&(t=null!=t?t.toString():t),t)}function n(e,n){var a=e.adapter._createChangeRequestInterceptor(e,n),i=[],o=[],s=[],u=e.entityManager,p=u.helper,c=0,l=e.routePrefix;return n.entities.forEach(function(e,n){var y=e.entityAspect;c+=1;var f={headers:{"Content-ID":c,DataServiceVersion:"2.0"}};if(s[c]=e,y.entityState.isAdded())f.requestUri=l+e.entityType.defaultResourceName,f.method="POST",f.data=p.unwrapInstance(e,t),o[c]=y.getKey();else if(y.entityState.isModified())r(f,y,l),f.method="MERGE",f.data=p.unwrapChangedValues(e,u.metadataStore,t);else{if(!y.entityState.isDeleted())return;r(f,y,l),f.method="DELETE"}f=a.getRequest(f,e,n),i.push(f)}),e.contentKeys=s,e.tempKeys=o,a.done(i),{__batchRequests:[{__changeRequests:i}]}}function r(e,t,n){var r,i=t.extraMetadata;null==i?(r=a(t),t.extraMetadata={uriKey:r}):(r=i.uriKey,i.etag&&(e.headers["If-Match"]=i.etag)),e.requestUri=r.indexOf("//")>0?r:n+r}function a(e){var t=e.entity.entityType,n=t.defaultResourceName,r=t.keyProperties,a=n+"(";if(1===r.length)a=a+i(r[0],e)+")";else{var o="";r.forEach(function(t){a=a+o+t.nameOnServer+"="+i(t,e),o=","}),a+=")"}return a}function i(e,t){return e.dataType.fmtOData(t.getPropertyValue(e.name))}function o(e,t){var n=new Error,r=e&&e.response;if(!r)return n.message=e,n.statusText=e,n;if(n.message=r.statusText,n.statusText=r.statusText,n.status=r.statusCode,t&&(n.url=t),n.body=r.body,r.body){var a;try{var i=JSON.parse(r.body);n.body=i,i["odata.error"]&&(i=i["odata.error"]);var o="";do a=i.error||i.innererror,a||(o+=s(i)),a=a||i.internalexception,i=a||i;while(a);o.length>0&&(n.message=o)}catch(u){}}return h._catchNoConnectionError(n),n}function s(e){var t=e.message||"";return("string"==typeof t?t:t.value)+"; "}var u,p=e.core,c=e.MetadataStore,l=e.JsonResultsAdapter,y=e.DataProperty,f=function(){this.name="OData"},h=f.prototype;h.initialize=function(){u=p.requireLib("OData","Needed to support remote OData services"),u.jsonHandler.recognizeDates=!0};var d=e.AbstractDataServiceAdapter.prototype;h._catchNoConnectionError=d._catchNoConnectionError,h.changeRequestInterceptor=d.changeRequestInterceptor,h._createChangeRequestInterceptor=d._createChangeRequestInterceptor,h.headers={DataServiceVersion:"2.0"},h.executeQuery=function(e){var t=Pt.defer(),n=e.getUrl();return u.read({requestUri:n,headers:this.headers},function(e,n){var r;return e.__count&&(r=parseInt(e.__count,10)),t.resolve({results:e.results,inlineCount:r,httpResponse:n})},function(e){return t.reject(o(e,n))}),t.promise},h.fetchMetadata=function(e,t){var n=Pt.defer(),r=t.serviceName,a=t.makeUrl("$metadata");return u.read({requestUri:a,headers:{Accept:"application/json;odata.metadata=full"}},function(i){if(!i||!i.dataServices){var o=new Error("Metadata query failed for: "+a);return n.reject(o)}var s=i.dataServices;if(!e.hasMetadataFor(r)){try{e.importMetadata(s)}catch(u){return n.reject(new Error("Metadata query failed for "+a+"; Unable to process returned metadata: "+u.message))}e.addDataService(t)}return n.resolve(s)},function(e){var t=o(e,a);return t.message="Metadata query failed for: "+a+"; "+(t.message||""),n.reject(t)},u.metadataHandler),n.promise},h.getRoutePrefix=function(){return""},h.saveChanges=function(e,t){var r=e.adapter=this,a=Pt.defer();e.routePrefix=r.getRoutePrefix(e.dataService);var i=e.dataService.makeUrl("$batch"),s=n(e,t),p=e.tempKeys,c=e.contentKeys;return u.request({headers:{DataServiceVersion:"2.0"},requestUri:i,method:"POST",data:s},function(e){var t=[],n=[],r={entities:t,keyMappings:n};return e.__batchResponses.forEach(function(e){e.__changeResponses.forEach(function(e){var r=e.response||e,s=r.statusCode;if(!s||s>=400)return void a.reject(o(e,i));var u=e.headers["Content-ID"],l=e.data;if(l){var f=p[u];if(f){var h=f.entityType;if(h.autoGeneratedKeyType!==xt.None){var d=f.values[0],m=h.getEntityKeyFromRawEntity(l,y.getRawValueFromServer),v={entityTypeName:h.name,tempValue:d,realValue:m.values[0]};n.push(v)}}t.push(l)}else{var g=c[u];t.push(g)}})}),a.resolve(r)},function(e){return a.reject(o(e,i))},u.batchHandler),a.promise},h.jsonResultsAdapter=new l({name:"OData_default",visitNode:function(e,t,n){var r={};if(null==e)return r;var a=e.__metadata;if(null!=a){var i=c.normalizeTypeName(a.type),o=i&&t.entityManager.metadataStore.getEntityType(i,!0);if(o&&o._mappedPropertiesCount<=Object.keys(e).length-1){r.entityType=o;var s=a.uri||a.id;if(s){var u=new RegExp("^"+t.dataService.serviceName,"i");s=s.replace(u,"")}r.extraMetadata={uriKey:s,etag:a.etag}}}e.results&&(r.node=e.results);var l=n.propertyName;return r.ignore=null!=e.__deferred||"__metadata"===l||"EntityKey"===l&&e.$type&&p.stringStartsWith(e.$type,"System.Data"),r}}),e.config.registerAdapter("dataService",f);var m=function(){this.name="webApiOData"};e.core.extend(m.prototype,h),m.prototype.getRoutePrefix=function(e){if("object"==typeof document){var t=document.createElement("a");t.href=e.serviceName}else t=url.parse(e.serviceName);var n=t.pathname;return"/"===n[0]&&(n=n.substr(1)),"/"!==n.substr(-1)&&(n+="/"),n},e.config.registerAdapter("dataService",m);var v=function(){this.name="webApiOData4"};e.core.extend(v.prototype,m.prototype),v.prototype.initialize=function(){var e=p.requireLib("datajs","Needed to support remote OData v4 services");
u=e.V4.oData,u.json.jsonHandler.recognizeDates=!0},v.prototype.headers={"OData-Version":"4.0"},e.config.registerAdapter("dataService",v)}),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!X&&define(["breeze"],e)}(function(e){var t=e.MetadataStore,n=e.JsonResultsAdapter,r=e.AbstractDataServiceAdapter,a=function(){this.name="webApi"},i=a.prototype=new r;i._prepareSaveBundle=function(e,t){var n=this._createChangeRequestInterceptor(e,t),r=e.entityManager,a=r.metadataStore,i=r.helper;return t.entities=t.entities.map(function(e,t){var r=i.unwrapInstance(e),o=null;e.entityType.autoGeneratedKeyType!==xt.None&&(o={propertyName:e.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:e.entityType.autoGeneratedKeyType.name});var s=i.unwrapOriginalValues(e,a);return r.entityAspect={entityTypeName:e.entityType.name,defaultResourceName:e.entityType.defaultResourceName,entityState:e.entityAspect.entityState.name,originalValuesMap:s,autoGeneratedKey:o},r=n.getRequest(r,e,t)}),t.saveOptions={tag:t.saveOptions.tag},n.done(t.entities),t},i._prepareSaveResult=function(e,n){var r=n.KeyMappings.map(function(e){var n=t.normalizeTypeName(e.EntityTypeName);return{entityTypeName:n,tempValue:e.TempValue,realValue:e.RealValue}});return{entities:n.Entities,keyMappings:r}},i.jsonResultsAdapter=new n({name:"webApi_default",visitNode:function(e,n,r){if(null==e)return{};var a=t.normalizeTypeName(e.$type),i=a&&n.entityManager.metadataStore._getEntityType(a,!0),o=r.propertyName,s=o&&"$"===o.substr(0,1);return{entityType:i,nodeId:e.$id,nodeRefId:e.$ref,ignore:s}}}),e.config.registerAdapter("dataService",a)}),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!X&&define(["breeze"],e)}(function(e){function t(e){var t=e.entityType||e.complexType,n=t._extra,a=n.alreadyWrappedProps||{};t.getProperties().forEach(function(t){var n=t.name;if(!a[n]){var o;o=n in e?i(e,t):r(e,t),null!=o&&Object.defineProperty(e,n,o),a[n]=!0}}),n.alreadyWrappedProps=a}function n(e){var t=o(e),n=Object.getPrototypeOf(e),r=n.entityType||n.complexType;return r.getProperties().forEach(function(t){var n=t.name;if(e.hasOwnProperty(n)){var r=e[n];delete e[n],e[n]=r}}),t}function r(e,t){var n=t.name,r=e._pendingBackingStores;r||(r=[],e._pendingBackingStores=r);var i={get:function(){var e=this._backingStore||o(this);return e[n]},set:function(e){var r=this._backingStore||s(this),i=a(r,n);this._$interceptor(t,e,i)},enumerable:!0,configurable:!0};return i.set.rawSet=function(e){var t=this._backingStore||s(this),r=a(t,n);r(e)},i}function a(e,t){return function(){return 0==arguments.length?e[t]:void(e[t]=arguments[0])}}function i(e,t){if(!e.hasOwnProperty(t.name)){var n=Object.getPrototypeOf(e);return i(n,t)}var r=Object.getOwnPropertyDescriptor(e,t.name);if(r.configurable&&!r.value&&r.set){var a=function(e){return function(){if(0==arguments.length)return r.get.bind(e)();var t=r.set,n=t.rawSet||t;n.bind(e)(arguments[0])}},o={get:function(){return r.get.bind(this)()},set:function(e){this._$interceptor(t,e,a(this))},enumerable:r.enumerable,configurable:!0};return o.set.rawSet=r.set,o}}function o(e){var t=Object.getPrototypeOf(e);u(t);var n=e._backingStore;return n||(n={},e._backingStore=n),n}function s(e){var t=Object.getPrototypeOf(e),n=t._pendingBackingStores,r=p.arrayFirst(n,function(t){return t.entity===e});if(r)return r.backingStore;var a={};return n.push({entity:e,backingStore:a}),a}function u(e){var t=e._pendingBackingStores;t&&(t.forEach(function(e){e.entity._backingStore=e.backingStore}),t.length=0)}var p=e.core,c=function(){this.name="backingStore"},l=c.prototype;l.initialize=function(){},l.getTrackablePropertyNames=function(e){var t=[];for(var n in e)if("entityType"!==n&&"_$typeName"!==n&&"_pendingSets"!==n&&"_backingStore"!==n){var r=e[n];p.isFunction(r)||t.push(n)}return t},l.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]},e.setProperty=function(e,t){return this[e]=t,this},t(e)},l.startTracking=function(t){var r=n(t),a=t.entityType||t.complexType;a.getProperties().forEach(function(n){var a=n.name,i=t[a];if(n.isDataProperty)n.isComplexProperty?i=n.isScalar?n.dataType._createInstanceCore(t,n):e.makeComplexArray([],t,n):n.isScalar?void 0===i&&(i=n.defaultValue):i=e.makePrimitiveArray([],t,n);else{if(!n.isNavigationProperty)throw new Error("unknown property: "+a);if(void 0!==i)throw new Error("Cannot assign a navigation property in an entity ctor.: "+n.Name);i=n.isScalar?null:e.makeRelationArray([],t,n)}(n.isSettable||n.isNavigationProperty)&&(r[a]=i)})},e.config.registerAdapter("modelLibrary",c)}),function(e){X?e(X):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!X&&define(["breeze"],e)}(function(e){function t(){try{return Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(e){return!1}}function n(e){var t=e.entityType||e.complexType,n={};if(t.getProperties().forEach(function(t){var a=r(e,t.name);a&&(n[t.name]=a)}),!V(n)){var a=t._extra;a.es5Descriptors=n,t._koDummy=s.observable(null)}}function r(e,n){if(!t())return null;if(e.hasOwnProperty(n))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e,n);var a=Object.getPrototypeOf(e);return a?r(a,n):null}function a(t,n,r){if(n.isDataProperty)n.isComplexProperty?r=n.isScalar?n.dataType._createInstanceCore(t,n):e.makeComplexArray([],t,n):n.isScalar?void 0===r&&(r=n.defaultValue):r=e.makePrimitiveArray([],t,n);else{if(!n.isNavigationProperty)throw new Error("unknown property: "+n.name);if(void 0!==r)throw new Error("Cannot assign a navigation property in an entity ctor.: "+n.name);r=n.isScalar?null:e.makeRelationArray([],t,n)}return r}function i(e){e._koObj._suppressBreeze=!0}function o(e){var t=e.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}var s,u=e.core,p=function(){this.name="ko"},c=p.prototype;c.initialize=function(){s=u.requireLib("ko","The Knockout library"),s.extenders.intercept=function(e,t){var n,r=t.instance,a=t.property;return n=s.computed(e.splice?{read:e}:{read:e,write:function(t){return r._$interceptor(a,t,e),r}})}},c.getTrackablePropertyNames=function(e){var t=[];for(var n in e)if("entityType"!==n&&"_$typeName"!==n){var a=r(e,n);if(a&&a.get)t.push(n);else{var i=e[n];s.isObservable(i)?t.push(n):u.isFunction(i)||t.push(n)}}return t},c.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]()},e.setProperty=function(e,t){return this[e](t),this},t()&&n(e)},c.startTracking=function(e){var t=e.entityType||e.complexType,n=t._extra.es5Descriptors||{};t.getProperties().sort(function(e,t){var n=e.isUnmapped?1:0,r=t.isUnmapped?1:0;return n-r}).forEach(function(r){var u,p=r.name,c=e[p],l=n[p];if(l){var y=l.get.bind(e);if(l.set){var f=l.set.bind(e),h=function(e){return 0===arguments.length?y():void f(e)};u=s.computed({read:function(){return t._koDummy(),y()},write:function(n){return e._$interceptor(r,n,h),t._koDummy.valueHasMutated(),e}})}else u=s.computed({read:y,write:function(){}})}else if(s.isObservable(c)){if(r.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+p);u=c}else c=a(e,r,c),u=r.isScalar?s.observable(c):s.observableArray(c);if(r.isScalar)if(l)Object.defineProperty(e,p,{enumerable:!0,configurable:!0,writable:!0,value:u});else{var d=u.extend({intercept:{instance:e,property:r}});e[p]=d}else c._koObj=u,u.subscribe(i,null,"beforeChange"),c.arrayChanged.subscribe(o),u.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},e[p]=u})},e.config.registerAdapter("modelLibrary",p)}),X.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery"});var tn=b("ko");return tn?X.config.initializeAdapterInstance("modelLibrary","ko"):X.config.initializeAdapterInstance("modelLibrary","backingStore"),X});